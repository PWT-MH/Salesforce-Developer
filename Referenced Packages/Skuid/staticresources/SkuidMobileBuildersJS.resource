/*! Skuid 6.8.7 26-02-2015 */
!function(a){function b(a){a||(a="NewModel");var b,c,d=a.substring(a.length-1,a.length);for(mb.isNumber(d)?(c=parseInt(d,10)-2+3,a=a.substring(0,a.length-1),b=a+c):(b=a,c=1);z(b).length>0;)b=a+""+c++;return b}function c(a,b){var c,d=a.split("."),e=d.shift(),f=e.charAt(0),g=(b?b.toLowerCase()+f.toUpperCase():f.toLowerCase())+e.slice(1);if(d.length)for(c=0;c<d.length;c++)e=d[c],g+=e.charAt(0).toUpperCase()+e.slice(1);return g.replace(/_/g,"").substring(0,25)}function d(a){jb.extend(this,a)}function e(b){b.header.text(b.builderId),b.body.css("padding","8px").text(a.$L("pb_no_component_renderer"))}function f(b,c){b.clear(),b.setHeaderText(c.builderId+" "+a.$L("properties")),b.body.append(jb("<div>").addClass("nx-pagebuilder-infotext").text(a.$L("pb_no_properties_renderer")))}function g(b){return b._GUID=a.utils.generateGUID(),Tb[b._GUID]=b,b}function h(a){delete Tb[a._GUID]}function i(){return jb.map(Tb,function(a){return a})}function j(a){rb[a.id]=a}function k(a){jb.each(a,function(){j(this)})}function l(a){return rb[a]}function m(){return rb}function n(a,b){var c,d=b.storeAs,e=b.location,f=b.id,g=b.defaultValue;if(e||(e=f?"attribute":"node"),d){if("node"===d.type&&d.name){var h=a.children(f).first().children(d.name);1===h.length?c=h.first().text():h.length>1&&(c=[],jb.each(h,function(){c.push(jb(this).text())}))}}else c="attribute"==e?a.attr(f):f?a.children(f).first().text():a.text();return jb.isArray(c)&&0===c.length?c.push(g):"undefined"==typeof c&&(c=g),c}function o(b,c){if(c||(c={}),b){var d,e=b,f=!1;c.selector?e=b.find(c.selector):c.childNodeName&&(e=b.children(c.childNodeName),e.length<1&&(e=nb("<"+c.childNodeName+"/>").appendTo(b))),c.storeAs&&c.storeAs.type&&"node"===c.storeAs.type?(e.empty(),jb.each(c.value,function(a,b){e.append(nb("<"+c.storeAs.name+"/>").text(b))}),f=!0):c.key?(d=e.attr(c.key),f="undefined"!=typeof c.value&&c.value!==d,f&&e.attr(c.key,c.value)):(f=c.value!==e.text(),f&&e.text(c.value)),!c.childNodeName||"undefined"!=typeof c.value&&""!==c.value||e.remove(),f&&a.events.publish("skuidBuilderSave")}}function p(b,c,d){mb.writeXmlToPageLayoutFields(b,c,d);var e=a.utils.size(ub);e>0&&jb.each(ub,function(a,b){return e>0?(b&&b.refresh&&b.refresh(),delete ub[a],e--,void 0):!0})}function q(b,c){var d=sb[b];d&&!d._isPreload?c(d):b&&a.RemotingStubs.getModelMetadata(JSON.stringify({sObjectName:b,loadChildRelationships:"true",loadPicklistValues:"false"}),function(a,d){d.status&&(sb[b]=JSON.parse(a),c&&c(sb[b]))},{escape:!1})}function r(a){var b,c=a.index()+1,d=c+": ",e=a.attr("type"),f="search"===e,g=a.attr("value"),h=a.attr("sourcetype"),i=a.attr("fieldfunction"),j="false"!==a.attr("enclosevalueinquotes");if("param"===h)b=a.attr("sourceparam"),d+=b?"(param) '"+b+"'":"[No Parameter]";else if("userinfo"===h)b=a.attr("sourceuserinfotype"),d+=b?"(userinfo) "+b:"[No Property]";else if("modelproperty"===h||"rowproperty"===h){if(b=a.attr("sourceproperty"),!b)return d+"[No Property selected]";var k,l=a.attr("fieldmodel");if(k=l?l+" Model ":"Context Model ","modelproperty"===h){if("hasRows"===b||"hasNoRows"===b)return d+k+"has"+("hasNoRows"===b?" no":"")+" data rows";if("hasChildRows"===b||"hasNoChildRows"===b)return d+"Context row in the "+k+"has"+("hasNoRows"===b?" no":"")+(a.attr("childrel")||"[No Child Relationship]")+" data rows";d+="data.length"===b?"# of rows in the "+k:"hasChanged"===b?k+" has unsaved changes":k+" "+b}else{if(k="Context Row in "+k,"isNew"===b)return d+k+" is new";if("isCloned"===b)d+=k+" is clone of existing record";else if("hasChanged"===b)d+=k+" has unsaved changes";else if("isSaved"===b)return d+k+" already exists in database"}}else d+=(i&&!f?i+"(":"")+(a.attr("field")||"[No Field]")+(i&&!f?")":"");if(d+=" "+Zb[a.attr("operator")||""].name+" ","param"==e)d+="(param) ";else if("userinfo"==e){var m=$b[a.attr("userinfotype")],n=m?m.label:"User Id";d+="(userinfo) "+n}else if("join"==e){d+="(SELECT "+(a.attr("joinfield")||"")+" FROM "+(a.attr("joinobject")||"");var o=a.children("condition");o.length&&(d+=" WHERE (<Sub Conditions>)"),d+=")"}else if("modelmerge"===e)d+="("+(a.attr("model")||"")+")("+(a.attr("mergefield")||"")+")";else if("multiple"===e){d+="(";var p=a.children("values").children();p.length&&(p.each(function(){d+=(j?"'":"")+jb(this).text()+(j?"',":",")}),d=d.substring(0,d.length-1)),d+=")"}else if("dependent"===e){var q=a.attr("depfield")||"<Unspecified>";d+="the value of the '"+q+"' field from the current row"}else f&&(d+="the search of "+i+" for '"+g+"'");if(("param"===e||"userinfo"===e)&&(j=!1),"fieldvalue"===e||"param"===e||"userinfo"===e||"blank"===e){j&&(d+="'"),d+=g||"";var r=a.attr("units");r&&(d+=" "+r),j&&(d+="'")}return"filterableon"!==a.attr("state")&&"filterableoff"!==a.attr("state")||!a.attr("name")||(d+=" (filterable as "+a.attr("name")+")"),"true"===a.attr("inactive")&&(d+=" (inactive)"),d}function s(a,b,c){var d;a&&(mb.isString(a)?d=z(a):a.length&&(d=a,a=d.attr("id")));var e=d&&d.children("fields,groupby").children('[id="'+mb.escapeSelector(b)+'"]');if(e&&"true"===e.attr("uionly")){var f=e.attr("displaytype"),g={displaytype:f,id:e.attr("id"),label:e.attr("label")};return-1!==jb.inArray(f,[Ib,Fb])&&(g.picklistEntries=jb.map(e.children("picklistentries").children(),function(a){return{value:a.value,label:a.label,active:!0}})),g}c||(c=a&&x(a));var h=b.split("."),i=h.pop(),j=e&&e.attr("targetobjects"),k=j&&j.split(",");h.length&&jb.each(h,function(){var a=sb[c],b=this;a&&jb.each(a.fields,function(){return this.rel==b?(c=this.ref,!1):void 0});var d=c.split(",");if(d.length>0)if(k){var e=k.shift();c=d.indexOf(e)?e:d[0]}else c=d.length>1?"Name":d[0]});var l=sb[c],m=null;return l&&jb.each(l.fields,function(){return this.id==i?(m=this,!1):void 0}),m}function t(a){var b,c,d=a.state;return d.is("field")?b=d.attr("id"):d.attr("field")&&(b=d.attr("field")),b?c=s(!1,b,v(a)):jb.inArray(d.attr("sourcetype"),["modelproperty","rowproperty"])>-1&&(c={displaytype:Yb[d.attr("sourceproperty")]||"STRING"}),c||(c=!1),c}function u(a){var b,c=a.state,d=t(a),e=c.attr("sourcetype"),f=c.attr("type");d&&(b=d.displaytype),"blank"===f||jb.inArray(e,["modelproperty","rowproperty"])>-1&&Yb[c.attr("sourceproperty")]||b&&-1!==jb.inArray(b,Ub)?c.attr("enclosevalueinquotes","false"):c.attr("enclosevalueinquotes","true")}function v(b){var c,d=b.state;if(d.is("field"))c=d.closest("model").attr("sobject");else if(b.isSubcondition)c=d.parent().closest("condition").attr("joinobject");else if(b.isChildRelationshipCondition){var e=C(d.closest("model").attr("id"),d.closest(a.mobile?"mobilefield":"field").attr("id"));c=e.childSObject}else if(b.isLookupFilterCondition){var f=s(d.parent().closest("[model]").attr("model"),d.closest(a.mobile?"mobilefield":"field").attr("id"));c=f?-1!==f.ref.indexOf(",")&&d.attr("fieldtargetobjects")?d.attr("fieldtargetobjects"):f.ref:null}else c=b.isRenderCondition||b.isUpdateAction?x(d.attr("fieldmodel")?d.attr("fieldmodel"):d.closest("[model]").attr("model")):d.closest("model").attr("sobject");return c}function w(a,b){return-1!==jb.inArray("User",b)||(-1!==jb.inArray("Contact",b)||-1!==jb.inArray("Lead",b))&&-1!==jb.inArray(a.id,bc)||-1!==jb.inArray(a.id,ac)}function x(a){return z(a).attr("sobject")}function y(){return lb.pageXML.children("models")}function z(a){return y().children('[id="'+a+'"]')}function A(){return y().children("model").first()}function B(a,b){var c;return mb.isString(b)?(c=z(b),c&&(c=c.children("conditions"))):b&&b.jquery&&"conditions"===b.prop("nodeName")&&(c=b),c?c.find('condition[name="'+a+'"]'):null}function C(a,b,c){c||(c=a&&x(a));var d=sb[c],e=null;return d&&jb.each(d.childRelationships,function(){return this.relationshipName===b?(e=this,!1):void 0}),e}function D(a,b){if(!a||!b)return!1;var c;if(mb.isString(a)===!0)c=z(a);else{if(!a.jquery)return!1;c=a}var d=c.children("fields,groupby").find('field[id="'+mb.escapeSelector(b)+'"]');return d&&d.length>0?!0:!1}function E(b){b||(b={});var c,d=b.fieldId,e=b.model,f=b.fieldBuilder||a.builder.fieldBuilder;if(c=f&&!a.mobile?function(a){return f.getDefaultState(a)}:lb.defaultStateGenerators.field,d&&e){var g,h=b.fieldsNode,i=b.fieldsElement,j=b.targetObjects;h||(h=e.children("fields")),i||(g=Fc(h),i=g&&g.element.find(".nx-pagebuilder-fieldschildren"));var k=h.children('[id="'+mb.escapeSelector(d)+'"]'),l="aggregate"===e.attr("type"),m=e.attr("id"),n=s(m,d),o=b.view,p=[];if(l||0===k.length){var q={id:d,needsAlias:l};l&&(h.is("groupby")?n&&n.displaytype==Bb&&(q.functionName="CALENDAR_YEAR"):q.functionName="SUM"),"childonly"===o&&(q.isRelationship=!0);var r="Id"!==d&&(mb.endsWith(d,"Id")||mb.endsWith(d,"__c")||mb.endsWith(d,"__pc"));if(p.push(c(q)),!l&&r){var t;if(n&&n.displaytype===Jb&&n.referenceTo&&n.referenceTo.length&&n.rel&&"null"!==n.rel){var u=1==n.referenceTo.length?n.referenceTo[0].objectName:"Name";if(!u||u in lb.fieldsDescribeCache||lb.getFields(u),n.referenceTo.length<2?(t=mb.getFieldReference(d,n),0===h.children('[id="'+mb.escapeSelector(t)+'"]').length&&p.push(c(t))):(t=mb.getFieldRelationshipName(d,n)+".Name",0===h.children('[id="'+mb.escapeSelector(t)+'"]').length&&p.push(c(t))),"skuid__Image__c"===n.referenceTo[0].objectName){var v=mb.getFieldRelationshipName(d,n)+".skuid__AttachmentId__c";0===h.children('[id="'+mb.escapeSelector(v)+'"]').length&&p.push(c(v))}}}jb.each(p,function(a,b){j&&b.attr("targetobjects",j),h.append(b),i&&f&&i.append(lb.componentFactory(b,f).element)})}if(p.length)return p}return!1}function F(a,b){b=b||{};var c,d,e,f=a.state;c=b.fieldMetadata?b.fieldMetadata:t(a),d=c?c.displaytype:!1,e="LOCATION"===d;var g={id:"type",type:"picklist",label:"Content",defaultValue:"fieldvalue",picklistEntries:[{label:"Single specified value",value:"fieldvalue"},{label:"Multiple specified values",value:"multiple"},{label:"Page/URL parameter value",value:"param"},{label:"Running user attribute",value:"userinfo"},{label:"None - blank value",value:"blank"},{label:"Field from another model",value:"modelmerge"},{label:"Result of subquery",value:"join"},{label:"Another field from row",value:"dependent"}],onChange:function(c,d){var e=t(a),g=e?e.displaytype:null;"fieldvalue"===d&&"multiple"===c&&f.attr("value")?f.append(nb("<values/>").append(nb("<value/>").text(f.attr("value")))):f.empty(),f.attr("value",""),f.attr("operator")in H(c,g)||f.attr("operator",-1!==jb.inArray(c,["multiple","join"])?"in":"="),f.removeAttr("enclosevalueinquotes model joinfield joinobject label"),"modelmerge"===c&&f.attr("model",lb.getFirstModel().attr("id")),"blank"===c&&f.attr("value","null"),lb.determineQuotedness(a),a.save().refresh(),b.handleChange&&b.handleChange(),b.handleRefresh&&b.handleRefresh()}};if(b.validTypes){var h=[];jb.each(g.picklistEntries,function(){-1!==b.validTypes.indexOf(this.value)&&h.push(this)}),g.picklistEntries=h}var i={id:"value",type:"string",label:"Value",onChange:function(){a.refresh(),b.handleChange&&b.handleChange()},metadata:c},j={id:"value",type:"string",label:"Parameter",onChange:function(){a.refresh(),b.handleChange&&b.handleChange()}},k={id:"novaluebehavior",type:"picklist",label:"If this Parameter is not provided, then...",helptext:"Specifies the action to take if the specified URL Parameter is not provided.",defaultValue:"",isNew:!0,picklistEntries:[{label:"Set its value to Blank",value:""},{label:"Deactivate this Condition",value:"deactivate"},{label:"Abort this Model's Query",value:"noquery"}]},l={id:"userinfotype",type:"picklist",label:"UserInfo Property",helptext:"The UserInfo variable to merge in as the value for the selected field.",defaultValue:"userid",picklistEntries:[],onChange:function(){a.refresh(),b.handleChange&&b.handleChange()}};jb.each(lb.userinfomap,function(a,b){l.picklistEntries.push({label:b.label,value:a})});var m={id:"mergefield",type:"field",label:"Source Field",modelprop:"model",defaultValue:"Id",displayTypeFilter:function(b,c){var d=a.state.attr("model");return d?D(d,c):!1},onChange:function(){a.refresh(),b.handleChange&&b.handleChange()}},n={id:"model",type:"model",label:"Source Model",helptext:"The Model whose first row's specified Merge Field's value will be used as the merge value for this Condition.",onChange:function(){a.refresh(),b.handleChange&&b.handleChange(),b.handleRefresh&&b.handleRefresh()}},o={id:"novaluebehavior",type:"picklist",label:"If no row in Source Model, then...",helptext:"Specifies the action to take if no rows are returned by the source model.",isNew:!0,defaultValue:"deactivate",picklistEntries:[{label:"Deactivate this Condition",value:"deactivate"},{label:"Abort this Model's Query",value:"noquery"}]},p={id:"joinobject",type:"sobject",label:"Join Object",helptext:"The Object to join in when performing a Semi-Join Sub-Select, e.g. Case in 'WHERE Id in (SELECT ContactId FROM Case)' ",onChange:function(){a.refresh(),b.handleChange&&b.handleChange(),b.handleRefresh&&b.handleRefresh()}},q={id:"joinfield",type:"field",label:"Join Field",helptext:"The field to join when performing a Semi-Join Sub-Select, e.g. ContactId in 'WHERE Id in (SELECT ContactId FROM Case)' ",sobject:f.attr("joinobject"),displayTypeFilter:["ID",Jb],onChange:function(){a.refresh(),b.handleChange&&b.handleChange()}},r={id:"logic",type:"string",label:"Subcondition Logic",onChange:function(){a.refresh()}},s={id:"values",location:"node",type:"multiitem",storeAs:{type:"node",name:"value"},label:"Values",onChange:function(){a.refresh(),b.handleChange&&b.handleChange()},metadata:c},u={id:"depfield",type:"field",label:"Depends On",sobject:x(a.state.closest("[model]").attr("model")),onChange:function(){a.refresh()}},v=[g,j],w=[g,i],y={fieldvalue:w,multiple:[g,s],param:v,userinfo:[g,l],blank:[g],modelmerge:[g,n,m,o],join:[g,p,q,r],dependent:[g,u]};return a.isRenderCondition||v.push(k),y[f.attr("type")||"fieldvalue"]}function G(a,b){b=b||{};var c=a.state,d=!1;"search"===c.attr("type")&&(d=!0,c.attr("field","Id"));var e={id:"field",type:"field",label:"Field",readonly:d,onChange:function(d,e,f){lb.updateState(c,{key:"fieldtargetobjects",value:f});var g=t(a),h=g?g.displaytype:!1;"fieldvalue"===c.attr("type")&&(h===xb?"false"!==c.attr("value")&&c.attr("value","true"):h===Eb?c.attr("value","0"):-1!==jb.inArray(h,[zb,Cb])?c.attr("value","0.0"):-1!==jb.inArray(h,[Ab,Bb])&&c.attr("value","")),lb.determineQuotedness(a),a.save().refresh(),b.handleChange&&b.handleChange()}};return b.sobject?e.sobject=b.sobject:b.modelprop?e.modelprop=b.modelprop:b.modelname&&(e.modelname=b.modelname),b.addFieldToModel&&(e.addFieldToModel=!0),b.showObjectPickerIfPolymorphic&&(e.showObjectPickerIfPolymorphic=!0),e}function H(a){var b,c,d={},e=arguments;return a&&!mb.isString(a)&&1===e.length?(b=a.type,c=a.displayType):(b=e[0],c=e[1]),jb.each(lb.operatormap,function(a,e){if(a&&-1!==jb.inArray(b||"fieldvalue",e.validFor)){var f=e.validForDisplayTypes,g=!0;f&&f.length&&c&&-1===jb.inArray(c,f)&&(g=!1),g&&(d[a]=e)}}),d}function I(a,b){b||(b={});var c=a.state,d=b.id||"operator",e=b.label||"Operator",f=b.defaultValue||"=",g=b.conditionType||c.attr("type"),h=b.fieldMetadata||!1,i=h?h.displaytype:!1,j={id:d,type:"picklist",label:e,defaultValue:f,picklistEntries:[],onChange:function(c){a.save().refresh(),b.handleChange&&b.handleChange(c)}};return jb.each(H({type:g,displayType:i}),function(a,b){j.picklistEntries.push({label:b.name,value:a})}),j}function J(a,b){b=b||{};var c=a.state,d={id:"state",type:"picklist",label:"Condition State",defaultValue:"",picklistEntries:[{label:"Always On",value:""},{label:"Filterable Default On",value:"filterableon"},{label:"Filterable Default Off",value:"filterableoff"},{label:"Always Off",value:"off"}],onChange:function(d){if(d&&"filterableon"!==d?c.attr("inactive","true"):c.attr("inactive","false"),"filterableon"!==d&&"filterableoff"!==d)c.removeAttr("name");else if(!c.attr("name")&&c.attr("field")){for(var e=c.attr("field"),f=e,g=1;B(f,c.closest("model").attr("id")).length;)f=e+""+g++;c.attr("name",f)}a.save().refresh(),b.handleChange&&b.handleChange(),b.handleRefresh&&b.handleRefresh()}},e={id:"name",type:"string",label:"Condition Name",helptext:"A unique name for this Condition, allowing it to be affected by Filters.",validator:function(b){return lb.validators.conditionName(b,a)},onChange:function(d,e){lb.publishStateEvent({type:"model.condition.nameChange",modelId:c.closest("model").attr("id"),oldName:e,newName:d}),a.save().refresh(),b.handleChange&&b.handleChange()}};return"filterableon"===c.attr("state")||"filterableoff"===c.attr("state")?[d,e]:[d]}function K(b,c,d,e){var f,g,h,i,j,k,l,m,n;if(b.metadata&&(g=b.metadata.displaytype,l=g===Ab||g===Bb),e?(i=e,h=e.text(),j=void 0):(i=c,h=c.attr(d),j=d),g===xb)f={value:"true"===h,onChange:function(a){var c=a?"true":"false";lb.updateState(i,{key:j,value:c}),b.onChange&&b.onChange(c)}};else if(g===Ib&&b.metadata.picklistEntries)f={value:mb.decodeHTML(h),onChange:function(a){lb.updateState(i,{key:j,value:a,required:!0}),b.onChange&&b.onChange(a)},entries:b.metadata.picklistEntries};else if(l){if(m=h,n="",h&&-1!==h.indexOf(":")){var o=h.split(":");m=o[0],n=o[1]}f={value:mb.decodeHTML(h),onChange:function(a){lb.updateState(i,{key:j,value:a}),b.onChange&&b.onChange(a)}}}else g="TEXT",h=h||b.defaultValue||"",f={value:mb.decodeHTML(h),onChange:function(a,c){var d=!0,e=k.parent().find(".nx-property-error");b.validator&&(d=b.validator(a)),d===!0?(e.length&&e.hide(),lb.updateState(i,{key:j,value:a}),b.onChange&&b.onChange(a,c)):(e.length?e.show():e=jb('<div class="nx-property-error">').insertAfter(k),e.text(d),k.val(c))}};if(k=a.ui.renderers[g].edit(f),l){var p,q,r,s,t=function(){"NONE"===p?q.show():q.hide(),n?s.show():s.hide()},u=lb.dateliteralmap[m],v=[];v.push({label:"Specific Date",value:"NONE"}),jb.each(lb.dateliteralmap,function(a){v.push({label:this.label,value:a})}),u?p=m:(p="NONE",n=""),q=k,r=a.ui.renderers.PICKLIST.edit({value:p,onChange:function(a){var c;a?(u=lb.dateliteralmap[a],u?(p=a,u.merge?(n="1",s.val(n),c=p+":"+n):(c=p,n="")):(p="NONE",c="",n="")):(c="",p="NONE",n=""),q.is(".hasDatepicker")?q.datepicker("setDate",""):q.find(".hasDatepicker").datepicker("setDate",""),lb.updateState(i,{key:j,value:c}),b.onChange&&b.onChange(c),t()},entries:v,required:!0}),s=a.ui.renderers.TEXT.edit({value:n,onChange:function(a){var c=r.val()+":"+a;lb.updateState(i,{key:j,value:c}),b.onChange&&b.onChange(c)}}),t(),k=jb("<div>").append(r,q,s)}return k}function L(){return[{value:"-",label:"",disabled:!0},{value:"-",label:"Model Conditions / Querying",disabled:!0},{value:"setCondition",label:"Activate & Set value of Model Condition"},{value:"activateCondition",label:"Activate Model Condition"},{value:"deactivateCondition",label:"Deactivate Model Condition"},{value:"requeryModel",label:"Query Model"},{value:"requeryModels",label:"Query Models"},{value:"-",label:"",disabled:!0},{value:"-",label:"Model data changes",disabled:!0},{value:"createRow",label:"Create new row"},{value:"updateRow",label:"Update a field on row(s)"},{value:"markRowsForDeletion",label:"Mark row(s) for deletion"},{value:"unmarkRowsForDeletion",label:"Unmark row(s) for deletion"},{value:"emptyModelData",label:"Empty Model data"},{value:"cancel",label:"Cancel Model changes"},{value:"save",label:"Save Model changes"},{value:"-",label:"",disabled:!0},{value:"-",label:"Advanced",disabled:!0},{value:"custom",label:"Run a Skuid JavaScript Snippet"},{value:"publish",label:"Publish Event"}]}function M(a){jb.each(a,function(){gc.push(this)})}function N(){return gc}function O(a,b){var c,d=function(b){var c;return b&&jb.each(b,function(b,d){return d.value===a?(c=d.label,!1):void 0}),c};return c=d(gc)||d(b),c||a}function P(a){var b=a.component,c=a.propViewer,d=a.contextModelName,e=b.state,f=e.attr("type"),g=[],h={id:"behavior",type:"picklist",label:"Query Behavior",defaultValue:"standard",picklistEntries:[{label:"Standard - Completely Replace Data",value:"standard"},{label:"Get More - Merge in new Rows with old",value:"loadmore"}]};if(-1!==jb.inArray(f,["save","cancel","requeryModels","emptyModelData"])){var i="Models to ";"save"===f?i+="Save":"cancel"===f?i+="Cancel":"requeryModels"===f?i+="Query":"emptyModelData"===f&&(i="Empty"),g.push({id:"models",label:i,type:"models"}),"save"===f?g.push({id:"rollbackonanyerror",label:"Roll back entire save on any error",helptext:"If true, then if there is any error while saving any of the selected Models, then the entire save operation will be rolled-back, as if no part of it ever occurred. ",type:"boolean"}):"requeryModels"===f&&g.push(h)}else if("redirect"===f)g.push({id:"url",label:"URL",type:"template",location:"attribute"},{id:"window",type:"picklist",label:"Open URL in",defaultValue:"self",picklistEntries:[{label:"Current window",value:"self"},{label:"Blank window",value:"blank"},{label:"Parent window",value:"parent"}]});else if("blockUI"===f){g.push({id:"message",type:"string",label:"Message"});for(var j={id:"timeout",type:"picklist",label:"Timeout (seconds)",picklistEntries:[{label:"Never",value:""}]},k=1;20>=k;k++)j.picklistEntries.push({value:500*k,label:k/2});g.push(j)}else if("publish"===f)g.push({id:"event",label:"Event name",type:"string"});else if("runProcessPlugin"===f)g.push({id:"pluginname",label:"Plugin Name",type:"string"});else if("createRow"===f||"requeryModel"===f||"markRowsForDeletion"===f)g.push({id:"model",label:"Model",type:"model",location:"attribute"}),"createRow"===f?g.push({id:"appendorprepend",type:"picklist",label:"Place row at...",defaultValue:"prepend",picklistEntries:[{label:"Start of Model data",value:"prepend"},{label:"End of Model data",value:"append"}]},{id:"defaultmodefornewitems",type:"picklist",label:"Have associated Components initially show this row in...",defaultValue:"edit",picklistEntries:[{value:"edit",label:"Edit mode"},{value:"read",label:"Read mode w/ inline-editing"}],helptext:"When this row is created, Components bound to this Model will create a new Item corresponding to the row. What Mode should the new Item start in?"}):"requeryModel"===f&&g.push(h);else if("adoptRows"===f)g.push({id:"sourcemodel",label:"Source Model",type:"model",location:"attribute"},{id:"targetmodel",label:"Target Model",type:"model",location:"attribute"});else if("updateRow"===f){g.push({id:"fieldmodel",label:"Model",type:"model",location:"attribute"});var l=lb.getConditionFieldPropObj(b,{handleChange:function(){c&&b.renderProperties&&b.renderProperties(c),b.rebuildProps&&b.rebuildProps()},modelprop:"fieldmodel"});g.push(l),b.isUpdateAction=!0,g.push({id:"value",type:"string",label:"Value",metadata:lb.getMetadataForField(b)})}else if("custom"===f)g.push({id:"snippet",label:"Name of Snippet to run",type:"string",location:"attribute"});else if(-1!==jb.inArray(f,["setCondition","activateCondition","deactivateCondition"])){g.push({id:"model",label:"Model",type:"model",location:"attribute",onChange:function(a,d,e){d!==!0&&e&&(b.refresh(),c&&b.renderProperties&&b.renderProperties(c),b.rebuildProps&&b.rebuildProps())}});var m=e.attr("model");m||(m=lb.getFirstModel(),m=m?m.attr("id"):null),g.push({id:"condition",label:"Condition",type:"condition",modelName:m,location:"attribute"}),"setCondition"===f&&g.push({id:"value",label:"Value",type:"template",location:"attribute",modelName:d})}return g}function Q(b,c){var d=[{id:"id",type:"string",label:"Model Id",helptext:"A unique identifier for this Model. Can only contain letters, numbers, or underscores.",validator:function(a){return lb.validators.modelId(a,b)},onChange:function(c,d){b.headerTitle?b.headerTitle.text(b.builder.name+" - "+c):b.element&&(b.element.find(".nx-pagebuilder-modeltag").children().eq(1).text(c),b.element.find(".nx-pagebuilder-fieldtag").attr("data-model",c)),lb.publishStateEvent({type:"model.idChange",oldId:d,newId:c}),a.events.publish("skuidBuilderRefreshModelList")}},{id:"sobject",type:"sobject",label:"SObject Type",onChange:function(){b.refresh(),a.mobile&&a.mobile.processResponsiveElements()}}],e=[{id:"limit",type:"string",label:"Max # of records (Limit)",helptext:"The maximum number of data records to pull in to this Model, out of all data records that match the Model's Conditions."},{id:"orderby",type:"string",label:"Fields to order records by",helptext:"How to order the data records pulled in to this Model, e.g. 'LastName DESC, FirstName' would order by LastName going from Z to A, then by FirstName going from A to Z (this is the ORDER BY clause of the generated SOQL statement)."},{id:"createrowifnonefound",type:"boolean",label:"Create default row if Model has none",helptext:"Typically used for Pages functioning as Overrides for the 'New' action. If true, then when this Page loads, if no data records exist in the Model, then a default row will be automatically created."},{id:"query",type:"boolean",label:"Load Model data on page load",helptext:"Typically this should be true, unless this Model will be used as a Calendar component Event Source. If false, then no data rows will be loaded in to this Model when the page initially loads.",onChange:function(){b.rebuildProps&&b.rebuildProps(),b.renderProperties&&b.renderProperties(c)}}];return"false"!==b.state.attr("query")&&e.push({id:"doclone",type:"picklist",label:"Clone Model data",helptext:"Should all data loaded into this Model on page load be 'cloned', meaning that data in the Model will be marked as 'New' so that when the Model is saved, new records will be created, rather than updates made to existing records?",picklistEntries:[{label:"Yes",value:"yes"},{label:"Yes, if 'clone' parameter is present in URL",value:""},{label:"No",value:"no"}],defaultValue:""}),e.push({id:"type",type:"picklist",label:"Model Type",picklistEntries:[{label:"Basic",value:""},{label:"Aggregate",value:"aggregate"}],defaultValue:"",onChange:function(){b.state.children("fields, groupby").empty(),b.save().refresh()}},{id:"queryallrows",type:"boolean",label:"Query Deleted / Archived records",helptext:'For developers: adds the SOQL "ALL ROWS" clause to your query. If true, then deleted records and/or archived Tasks will be included in your Model\'s query --- by default, they are not.'},{id:"forview",type:"boolean",label:'Update Salesforce "Recently Viewed" info',helptext:"For developers: adds the SOQL \"FOR VIEW\" clause to your query. Use this if you want this Model to feed into Salesforce's tracking of Recently Viewed Items. When this Model's query is run, the LastViewedDate for all records in this Model will be updated, and new records will be added to the RecentlyViewed object. "}),[{name:"Basic",props:d},{name:"Advanced",props:e}]}function R(a,b,c,d){var e,f,g=z(b),h=g?"aggregate"==g.attr("type"):!1,i=a.state,j=i.attr("type"),k=i.attr("id"),l=k&&-1!=k.indexOf("."),m=k?s(b,k):!1,n=m?m.displaytype:!1,o=lb.getSObjectNameFromModelName(b),p='The desired width of this column, relative to the total width available to its containing table. This is an Approximate width, as the actual width may be different depending on how much room the HTML table has available to it. A percentage (e.g. 25%) is recommended, but a pixel amount, e.g. "200px" is also possible --- however, do NOT mix and match pixels/percents among columns in the table.';if("COMBO"===j||"CHILDREL"===j){if(e=[{id:"label",type:"template",label:"Label",onChange:function(){a.refresh()}},{id:"template",type:"template",label:"Template",onChange:function(){a.refresh()}},{id:"allowhtml",type:"boolean",label:"Allow HTML",defaultValue:!1,onChange:function(){a.refresh()}},{id:"valuehalign",type:"picklist",label:"Horizontal Alignment",helptext:"(Optional) The alignment of the field value within its container. Defaults to Left.",picklistEntries:[{label:"Left (default)",value:""},{label:"Right",value:"right"}],defaultValue:""},{id:"readonly",type:"boolean",label:"Read-only",defaultValue:!1,onChange:function(){a.rebuildProps()}}],"skootable"===c&&(e.push({id:"columnwidth",type:"string",label:"Column Width",helptext:p}),"COMBO"===j&&(e.push({id:"allowordering",type:"boolean",label:"Allow Ordering",onChange:function(){a.rebuildProps()}}),"true"===i.attr("allowordering")&&e.push({id:"orderfield",type:"field",label:"Order Field",sobject:o}))),"true"!==i.attr("readonly")&&"COMBO"===j&&"basicfieldeditor"===c&&(e.push({id:"editmodebehavior",type:"picklist",label:"Edit Mode behavior",defaultValue:"autopopup",picklistEntries:[{label:"Show default Popup",value:"autopopup"},{label:"Show custom Popup",value:"custompopup"}],onChange:function(){a.rebuildProps()}}),"custompopup"===i.attr("editmodebehavior"))){var q=kb.desktop.makePopupBuilder({title:"Template Field Edit Mode Popup Properties",linkedComponent:a,makePropsEditor:function(a,b){var c={id:"title",type:"template",location:"attribute",label:"Popup Title",onChange:function(a){b.element.dialog("option","title",a)}},d={id:"width",type:"string",label:"Width (% or px)",defaultValue:"450",onChange:function(a){b.element.dialog("option","width",a)}};return kb.desktop.buildPropsEditor(b.state,[c,d])}}),r=i.children("editmodepopup");if(0===r.length){var t,u=i.children("template").text();u.length&&(t=mb.extractFieldsFromTemplate(u,{ignoreGlobals:!0})),r=q.defaultStateGenerator({id:"editmodepopup",title:i.children("label").text()||"Template Field",width:"450",childComponents:nb('<basicfieldeditor showsavecancel="false" mode="edit" model="'+b+'"><columns><column width="100%"><sections><section title=""><fields>'+(t.length?'<field id="'+t.join('"/><field id="')+'"/>':"")+"</fields></section></sections></column></columns></basicfieldeditor>")}),i.append(r)}a.editModePopupComponent=lb.componentFactory(r,q,!0),e.push({id:"editmodepopup",type:"customaction",label:"Configure Edit Mode Popup",icon:"sk-bi-popup",customAction:function(){a.editModePopupComponent.select()}})}"CHILDREL"===j&&e.push({id:"delimiter",type:"string",label:"Delimiter"}),f=[{name:"Basic",props:e}]}else{var v=[];n&&(n===Ib?(v.push({label:"Standard",value:""}),v.push({label:"Radio Buttons",value:"RADIO_BUTTONS"})):n===Fb?(v.push({label:"Standard",value:""}),v.push({label:"Checkboxes",value:"CHECKBOXES"})):n===Jb?"skuid__Image__c"===m.ref?v.push({label:"File Upload",value:""}):(v.push({label:"Auto-Complete",value:""}),v.push({label:"Picklist",value:"REFPICK"})):n===Ab&&v.push({label:"Standard",value:""})),v.length||v.push({label:"Standard",value:""}),v.push({label:"Custom (run a Snippet)",value:"CUSTOM"});var w;w="mobilefield"===c?{id:"id",type:"field",label:"Field",modelname:b,filter:function(a,b){var c;return c=g.children("fields,groupby").find(a.displaytype!==Jb?'field[id="'+mb.escapeSelector(b+a.id)+'"]':'field[id^="'+mb.escapeSelector(b+a.rel+".")+'"]'),0!==c.length},onChange:function(b){a.element.attr("data-field",b),a.state.removeAttr("type"),a.save().refresh().renderProperties(d)}}:{id:"id",type:"readonly",label:"Field Id"};for(var x={id:"type",type:"picklist",label:"Field Renderer",defaultValue:"",picklistEntries:v,onChange:function(){a.save().refresh(),a.rebuildProps&&a.rebuildProps(),a.renderProperties&&a.renderProperties(d)}},y={id:"name",type:"readonly",label:"Field Alias Name"},A={id:"label",type:"template",location:"node",label:"Custom Label",onChange:function(){a.refresh()}},B={id:"optionsource",type:"picklist",label:"Option Source",defaultValue:"",picklistEntries:[{label:"Automatic",value:""},{label:"Model",value:"model"}],onChange:function(){i.removeAttr("displaytemplate searchtemplate"),"undefined"!=typeof i.attr("optionmodel")&&i.removeAttr("optionmodel"),a.refresh(),a.rebuildProps&&a.rebuildProps(),a.renderProperties&&a.renderProperties(d)}},C={id:"optionmodel",type:"model",label:"Option Model",objectTypeFilter:m?m.ref:!1,onChange:function(b,c){c!==!0&&(i.removeAttr("displaytemplate searchtemplate"),a.refresh(),a.rebuildProps&&a.rebuildProps(),a.renderProperties&&a.renderProperties(d))}},D={id:"displaytemplate",type:"template",label:"Display Template",modelprop:"optionmodel",fieldContext:m?m:null,fieldId:k,location:"attribute",helptext:'The fields from related records to display, specified using Merge syntax, e.g. "{{Name}} - {{Industry}}" would show the Name and Industry of related Accounts, if this is the AccountId field. Fields can be easily added using the Merge-Field Picker to the right.'},E={id:"searchtemplate",type:"template",label:"Search Template",modelprop:"optionmodel",fieldContext:m?m:null,fieldId:k,location:"attribute",helptext:'The fields from related records to display on search, specified using Merge syntax, e.g. "{{Name}} - {{Industry}}" would show the Name and Industry of related Accounts, if this is the AccountId field. Fields can be easily added using the Merge-Field Picker to the right.'},F={id:"allowordering",type:"boolean",label:"Allow Ordering"},G={id:"columnwidth",type:"string",label:"Column Width",helptext:p},H={id:"summaries",location:"node",type:"multipicklist",storeAs:{type:"node",name:"summary"},label:"Column Summaries",helptext:"Choose one or more summary type(s) for this field. Summaries are displayed at the bottom of a table.",picklistEntries:[{label:"Sum",value:"sum"},{label:"Average",value:"avg"},{label:"Min",value:"min"},{label:"Max",value:"max"},{label:"Median",value:"med"}],noneSelectedText:"Select Summary Type(s)...",onChange:function(){a.rebuildProps&&a.rebuildProps(),a.renderProperties&&a.renderProperties(d)
}},I={id:"countBlanks",type:"boolean",label:"Count Blanks in Summaries",helptext:"Set this to true if you  want blank values to be counted in summary calculations."},J={id:"readonly",type:"boolean",label:"Read-only",readonly:l||(m?m.calculated:!1),defaultValue:l||(m?m.calculated:!1)},K={id:"required",type:"boolean",label:"Required",defaultValue:(m?m.required:!1)&&!l,readonly:(m?m.required:!1)||(m?m.calculated:!1),onChange:function(){n&&(n===Ib||n===Jb&&"REFPICK"===i.attr("type"))&&(a.save().refresh(),a.rebuildProps&&a.rebuildProps(),a.renderProperties&&a.renderProperties(d))}},L={id:"addnoneoption",type:"boolean",label:'Add "None" option',helptext:'When a Picklist is required, Skuid normally does not add a "--None--" option at the beginning of the list of options, and instead will auto-select the first available Picklist option if none has yet been selected. There is then no way for the user to go back to "--None--". This is sometimes undesirable and can lead to bad data, because users will not realize that an option was auto-selected and therefore will not select an accurate option. Checking this property will add a "--None--" option at the top of the list, which will be selected by default.',defaultValue:!1},M={id:"tokenizesearch",type:"boolean",label:"Tokenize autocomplete search",defaultValue:!1,helptext:"Search separately on each term, rather than requiring a field to contain a match on the whole search string entered."},N={id:"maxdisplaycharacters",type:"string",label:"Max Characters to Display",helptext:"(Read Mode only) The maximum number of characters that will be displayed for this textarea in Read mode before the text is curtailed with '...'"},O={id:"decimalplaces",type:"picklist",label:"# of Decimal Places",helptext:"(Optional) The number of decimal places / digits to show in Read mode. Defaults to the number of decimal places configured in the Salesforce field's metadata.",picklistEntries:[{label:"(Use field metadata)",value:""}],defaultValue:""},P={id:"valuehalign",type:"picklist",label:"Horizontal Alignment",helptext:"(Optional) The alignment of the field value within its container.",picklistEntries:[{label:"Left (default)",value:""},{label:"Right",value:"right"}],defaultValue:""},Q={id:"snippet",type:"string",label:"Render Snippet Name",helptext:'The name of a Skuid Snippet to run that will serve as a "Custom Renderer". Snippets are named JavaScript functions, and can be created by going to the Resources tab and creating a new JavaScript Resource of type "Inline (Snippet)". If your Resource Name is "CustomDatepicker", then you should enter "CustomDatepicker" here.'},R={id:"showhelp",type:"boolean",label:"Show Inline Help",defaultValue:!0,helptext:"If true, Inline Help Text for this field will be shown."},S={id:"maxselected",type:"string",label:"Max selectable items (optional)",helptext:"The maximum number of picklist items that a user can select. By default, the user can select as many items as they want."},T=0;9>T;T++)O.picklistEntries.push({value:T+"",label:T+""});if(!k)return f=[{name:"Basic",props:[w]}];var U,V,W=[w,A,J,K,N,G,P,x],X=[w,A,F,H,J,K,G,O,P,x],Y=[w,A,F,H,J,K,G,P,x];"skootable"===c?(n===Lb&&m&&m.sortable&&W.splice(2,0,F),U={TEXTAREA:W,REFERENCE:[w,A,F,J,K,G,P,x],DEFAULT:[w,A,F,J,K,G,P,x],MULTIPICKLIST:[w,A,J,K,G,S,P,x],BOOLEAN:[w,A,F,J,x,P,G],INTEGER:Y,DOUBLE:X,PERCENT:X,CURRENCY:X},V={REFERENCE:[B,D,E],DEFAULT:[]},i.children("summaries").children("summary").length>0&&(Y.splice(4,0,I),X.splice(4,0,I))):(U={TEXTAREA:[w,A,R,J,K,N,P,x],REFERENCE:[w,A,R,J,K,P,x],BOOLEAN:[w,A,R,J,P,x],MULTIPICKLIST:[w,A,R,J,K,S,P,x],DOUBLE:[w,A,R,J,K,O,P,x],PERCENT:[w,A,R,J,K,O,P,x],CURRENCY:[w,A,R,J,K,O,P,x],DEFAULT:[w,A,R,J,K,P,x]},V={REFERENCE:[B,D,E],DEFAULT:[]}),(n===Ib||n===Jb&&"REFPICK"===j)&&(m&&m.required||"true"===i.attr("required"))&&(U[n]="skootable"===c?[w,A,F,J,K,L,G,P,x]:[w,A,R,J,K,L,P,x]),"basicfieldeditor"===c&&m&&(m.inlineHelpText?"undefined"==typeof i.attr("showhelp")&&i.attr("showhelp","true"):jb.each(U,function(a,b){b.splice(2,1)})),"model"===i.attr("optionsource")&&V.REFERENCE.push(C),i.attr("type")||V.REFERENCE.push(M),e=(U[n]||U.DEFAULT).slice(0);var Z=(V[n]||V.DEFAULT).slice(0);if("CUSTOM"===i.attr("type")&&e.push(Q),h){U={TEXTAREA:[w,y,A,G,N,P],DOUBLE:[w,y,A,G,O,P],PERCENT:[w,y,A,G,O,P],CURRENCY:[w,y,A,G,O,P],DEFAULT:[w,y,A,G,P]},e=(U[n]||U.DEFAULT).slice(0);var _=g.children("groupby").children('[name="'+mb.escapeSelector(i.attr("name"))+'"]'),ab=_&&_.length;ab?m&&m.sortable&&e.push(F):(e.push(H),i.children("summaries").children("summary").length>0&&e.push(I),e.push(F)),e.push(x),"CUSTOM"===i.attr("type")&&e.push(Q),f=[{name:"Basic",props:e}]}else if(n===Jb){var bb=[{label:"Search Properties",linkedComponent:a,deleteable:!1,props:Z}];1===m.referenceTo.length&&bb.push(Gc({sobject:m.ref,linkedComponent:a,isReference:!0})),f=[{name:"Basic",props:e},{name:"Search",tree:bb}]}else f=[{name:"Basic",props:e},{name:"Advanced",props:Z}];h||n!==Jb||f.push({name:"Filters",tree:{id:"filters",label:"Lookup Filters",linkedComponent:a,deleteable:!1,icon:"sk-bi-filters",isChild:!0,children:[{id:"filter",addtooltip:"Add New Lookup Filter",labelFunction:function(a){return lb.getConditionDisplayString(a)},defaultStateFunction:function(){return nb('<filter type="fieldvalue" operator="=" enclosevalueinquotes="true"/>')},propsFunction:function(a){var b=a.state;b.attr("operator")||b.attr("operator","="),a.isLookupFilterCondition=!0;var c=lb.getMetadataForField(a);if(!c&&b.attr("field")){var e=lb.getSObjectForField(a);if(-1===e.indexOf(","))return lb.getFields(e,function(){lb.getMetadataForField(a)||b.removeAttr("field"),a.rebuildProps&&a.rebuildProps(),a.renderProperties&&a.renderProperties(d)}),[]}var f=[lb.getConditionFieldPropObj(a,{sobject:lb.getSObjectForField(a),showObjectPickerIfPolymorphic:!0,handleChange:function(){a.rebuildProps&&a.rebuildProps(),a.renderProperties&&a.renderProperties(d)}}),lb.getConditionOperatorPropObj(a,{fieldMetadata:c})];return f.concat(lb.getConditionValueProperties(a,{handleRefresh:function(){a.rebuildProps&&a.rebuildProps(),a.renderProperties&&a.renderProperties(d)},validTypes:["fieldvalue","multiple","blank","userinfo","param","modelmerge","dependent"]}))}}]}})}return"skootable"!==c&&(f[0].props.push(lb.coreProps.cssClassProp()),f.push($({component:a,propViewer:d,model:b,showOnHideDataBehaviorProp:!0}))),f}function S(a,b,c,d){d=d||{};var e=a.state,f=e.attr("type"),g=[],h=[],i=d.onActionTypeChange,j=d.additionalActionOptions,k=jb.merge([],N());j&&j.length&&(k.push({value:"-",label:"",disabled:!0}),k.push({value:"-",label:"Additional actions",disabled:!0}),jb.each(j,function(){k.push(this),f===this.value&&(this.props&&this.props.length&&jb.each(this.props,function(){h.push(this)}),this.propsFunction&&(h=h.concat(this.propsFunction(a))))})),g.push({id:"type",label:"Action Type",type:"picklist",options:k,onChange:function(c){a.refresh(),a.rebuildProps&&a.rebuildProps(),b&&a.renderProperties&&a.renderProperties(b),i&&i(c)}}),"showPopup"===f?g.push({type:"customaction",label:"Configure Popup",icon:"sk-bi-popup",customAction:function(){kb.desktop.showPopupBuilder({parentComponent:a,contextModelName:c})}}):-1!==jb.inArray(f,["toggleLeftPanel","setLeftPanel","setMainPanel","setPopupPanel"])&&(g.push({id:"panel",label:"Panel",type:"panel"}),"setPopupPanel"===f&&g.push({id:"title",label:"Popup Title",type:"template",location:"attribute"}));var l=lb.getCoreActionProperties({propViewer:b,component:a,contextModelName:c});return l.length&&jb.each(l,function(a,b){g.push(b)}),h.length&&jb.each(h,function(a,b){g.push(b)}),g}function T(a){a||(a={});var b,c=a.treeNode||{},d=a.propViewer,e=a.useModelName,f=a.linkedComponent,g=a.refreshLinkedComponent,h=c.indent||0;return b={id:"action",deletetooltip:"Remove Action",refreshLinkedComponent:g,linkedComponent:f,labelFunction:function(b){return lb.getActionLabel(b.attr("type"),a.additionalActionOptions)},labelEventHandlers:{dblclick:function(a){var b=a.state,c=b.attr("type"),d=kb.desktop;d&&("drawer"===c?d.showDrawerBuilder({parentComponent:a,contextModelName:e}):"showPopup"===c&&d.showPopupBuilder({parentComponent:a,contextModelName:e}))}},defaultStateFunction:function(){return nb('<action type="save"/>')},propsFunction:function(b){return S(b,d,e,a)},childrenFunction:function(b){var c=[],e=b.state,f=e.attr("type");return"createRow"===f&&c.push({id:"default",labelFunction:function(a){var b=a.attr("field")||"[No Field]",c=a.attr("value");return"undefined"==typeof c&&(c="[No Value]"),b+": "+c},invisibleParent:"defaults",invisibleParentLabel:"Default Values",indent:1+h,addtooltip:"Add Default Value",deletetooltip:"Remove Default Value",propsFunction:function(a){var b,c=a.state,f=c.attr("field"),g=[],h=e.attr("model"),i={showObjectPickerIfPolymorphic:!0,addFieldToModel:!0,handleChange:function(){a.refresh(),a.rebuildProps&&a.rebuildProps(),a.renderProperties&&a.renderProperties(d)},modelname:h};if(g.push(lb.getConditionFieldPropObj(a,i)),f&&h){var j=z(h);j&&(b=s(h,f,j.attr("sobject")))}return g.concat(lb.getConditionValueProperties(a,{fieldMetadata:b,handleRefresh:function(){var b=c.attr("field");b&&(a.rebuildProps&&a.rebuildProps(),a.renderProperties&&a.renderProperties(d))},validTypes:["fieldvalue","blank"]}))},defaultStateFunction:function(){return nb("<default/>")}}),-1!==jb.inArray(f,["save","requeryModel","requeryModels","custom","runProcessPlugin"])?c.push(T(jb.extend({},a,{treeNode:{invisibleParent:"onerroractions",invisibleParentLabel:"On-Error Actions",indent:1+h,icon:"sk-bi-action-error",addicon:"sk-bi-action-error",addtooltip:"Add on-error Action",deletetooltip:"Remove on-error Action",defaultStateFunction:function(){return nb('<action type="blockUI" message="There was an error" timeout="3000"/>')}}}))):a.additionalActionOptions&&jb.each(a.additionalActionOptions,function(){this.value===f&&this.childrenFunction&&(c=c.concat(this.childrenFunction(b)))}),c}},c&&jb.extend(b,c),b}function U(a){a||(a={});var b=a.linkedComponent,c=!1;return b&&a.refreshLinkedComponent&&(c=!0),{name:a.label||"Actions",tree:{id:a.customNodeId||"actions",label:a.label||"Actions",deleteable:!1,props:a.props,linkedComponent:b,refreshLinkedComponent:c,icon:"sk-icon-component-pack",addtooltip:"Add Action",isChild:!0,childrenFunction:function(d){return[T({linkedComponent:b,refreshLinkedComponent:c,component:d,propViewer:a.propViewer,useModelName:a.useModelName,additionalActionOptions:a.additionalActionOptions})]}}}}function V(a){a||(a={});var b=a.propViewer,c=a.useModelName,d=a.allowChildActions||!1,e=a.id||"hotkeys",f=a.label||"Hotkeys",g={id:"hotkey",deletetooltip:"Remove Hotkey",labelFunction:function(a){var b=a.attr("modifiers"),c=a.attr("key"),d="";return b&&jb.each(b.split(","),function(a,b){jb.each(hc,function(){return this.value===b?(d+=this.label+"+",!1):void 0})}),jb.each(kc,function(){return this.value===c?(d+=this.label,!1):void 0}),d},defaultStateFunction:function(){return nb('<hotkey modifiers="ctrl" key="n"/>')},propsFunction:function(a){var c=function(){a.refresh&&a.refresh()},d=[{id:"modifiers",location:"attribute",type:"multipicklist",label:"Modifiers",helptext:"Choose one or more modifiers that must be pressed at the same time as the principal hot key",picklistEntries:hc,defaultValue:"ctrl",noneSelectedText:"Select Modifiers...",onChange:function(d){d&&"shift"!==d||(a.state.attr("ignoretextinputs","true"),a.save(),a.rebuildProps&&a.rebuildProps(),b&&a.renderProperties&&a.renderProperties(b)),c()}},{id:"key",type:"picklist",label:"Key",picklistEntries:kc,defaultValue:"S",onChange:c},{id:"ignoretextinputs",type:"boolean",label:"Ignore Hot Key if user is typing in input element",helptext:"If true, then this Hot Key will be ignored while a user is entering text into any text input area. This option should be used if the Hot Key would conflict with typical data entry Hot Keys, such as arrow keys, copy/paste, etc."}];return d}};return d&&(g.childrenFunction=function(a){return[T({component:a,propViewer:b,useModelName:c,treeNode:{indent:1,invisibleParent:"actions"}})]},g.addtooltip="Add Hotkey Action"),{name:f,tree:{id:e,label:f,linkedComponent:a.linkedComponent,deleteable:!1,icon:"sk-icon-component-pack",addtooltip:"Add Hotkey",isChild:!0,children:[g]}}}function W(a){a.empty(),mc[nc]&&mc[nc].icons&&jb.each(mc[nc].icons,function(b){var c=b.substr(nc.length+1),d=jb("<div>").addClass("nx-picker-icon "+nc+" "+b).attr("alt",c).attr("title",c),e=jb('<div class="nx-picker-icon-label">').text(c);jb('<div class="nx-picker-icon-wrapper">').append(d,e).appendTo(a)})}function X(a,b,c){var d=function(a){mc=a.iconsets,jb.each(mc,function(a,b){var c=jb("<div>").addClass("nx-picker-header-category").text(b.label);c.data("category",a),nc===a&&c.addClass("nx-picker-selected"),c.data("prefix",a),i.append(c)}),W(h)};mc.length||lb.getIconsObject(d),a.addClass("nx-picker-wrapper").appendTo("body");var e=jb("<div>").addClass("nx-picker-header").appendTo(a),f=jb("<input>").addClass("nx-picker-filter-input").attr("type","text").appendTo(e),g=jb("<div>").addClass("nx-picker-cancel inline sk-icon sk-icon-cancel").css("cursor","pointer").css("margin","0px 5px 4px").skootip("Clear Filter Text").appendTo(e),h=jb("<div>").addClass("nx-picker-body").appendTo(a),i=jb("<div>").addClass("nx-picker-header-category-wrapper").appendTo(e);jb("<label>").text("Filter Icons: ").appendTo(e),i.on("click",".nx-picker-header-category",function(){var a=jb(this);i.find(".nx-picker-selected").removeClass("nx-picker-selected"),a.addClass("nx-picker-selected"),nc=a.data("prefix"),W(h)}),mb.delayInputCallback(f,function(a){var b=h.parent();a=a.toLowerCase(),h.detach(),""===a?h.find(".nx-picker-icon-wrapper").show():(h.find("."+nc).not('[alt*="'+a+'"]').parent().hide(),h.find("."+nc+'[alt*="'+a+'"]').filter(":hidden").parent().show()),h.appendTo(b)}),h.skootip(),g.click(function(){f.val("").change()}),h.on("click",".nx-picker-icon-wrapper",function(){var d=jb(this).children("."+nc).first().attr("alt");b.val(nc+"-"+d).change(),c.empty().removeClass().addClass("nx-picker-icon "+nc+" inline "+nc+"-"+d),a.dialog("close")})}function Y(a){var b=a.parent();if(b.length){if(b[0]&&"skuidpage"===b[0].nodeName)return!1;var c=Fc(b);return c&&c.builder&&c.builder.givesContext?c:Y(b)}return!1}function Z(a){a||(a={});var b,c=a.state,d=a.model,e=Y(c);return e?(b=e.contextModelName,{name:"Context",isNew:!0,tree:{id:"conditions",label:"Context Conditions",deleteable:!1,isChild:!0,children:[{id:"condition",labelFunction:function(a){return(a.attr("field")||"Id")+" of record(s) = "+(a.attr("mergefield")||"Id")+" of row in context."},defaultStateFunction:function(){return nb('<condition type="contextrow" field="Id" mergefield="Id" />')},propsFunction:function(a){var c,e=[];return d&&(c=d),c?(e.push({id:"field",type:"field",label:"Field",helptext:"The field on this component's model that will be checked against a field on the row in context.",modelname:c,onChange:function(){a.refresh()}}),b&&e.push({id:"mergefield",type:"field",label:"Merge Field",helptext:"The field on the row in context that will be checked against a field on this component's model.",modelname:b,onChange:function(){a.refresh()}}),e):!1}}]}}):!1}function $(a){a||(a={});var b=a.propViewer,c=a.component,d=a.model,e=a.showOnHideDataBehaviorProp;return{name:"Rendering",tree:{id:"renderconditions",label:"Render Conditions",deleteable:!1,icon:"sk-bi-renderconditions",isChild:!0,linkedComponent:c,propsFunction:function(a){var c=[],d=a.state,f=d.attr("logictype");if(f||(f="and",d.attr("logictype",f)),c.push({id:"logictype",type:"picklist",label:"Render if...",defaultValue:"and",picklistEntries:[{label:"ALL Conditions are met",value:"and"},{label:"ANY Conditions are met",value:"or"},{label:"Custom logic is met",value:"custom"}],onChange:function(c,e){if("custom"===c&&!d.attr("logic")){var f=d.children(),g=[];f.length&&(f.each(function(a){g.push(a+1)}),d.attr("logic",g.join(" AND ")),a.save())}c&&e&&(a.rebuildProps&&a.rebuildProps(),a.renderProperties&&a.renderProperties(b))}}),"custom"===f&&c.push({id:"logic",type:"string",label:"Condition Logic",helptext:"Custom logic for grouping and applying these Render Conditions, e.g. ((1 AND 2) OR (3 AND 4))."}),e){var g="onhidedatabehavior";""===d.attr(g)&&d.attr(g,"cancel"),c.push({id:g,isNew:!0,type:"picklist",label:"If hidden, Model field changes should be...",helptext:"When this Field is hidden by Conditional Rendering, by default any changes to this Field's Model data will be left in the Model. You may want to have hidden data changes cancelled, so that the changes are not saved along with visible data changes.",defaultValue:"keep",picklistEntries:[{label:"Retained in Model",value:"keep"},{label:"Cancelled",value:"cancel"}]})}return c},children:[{id:"rendercondition",addtooltip:"Add New Render Condition",labelFunction:function(a){return lb.getConditionDisplayString(a)},defaultStateFunction:function(){return nb('<rendercondition type="fieldvalue" operator="=" enclosevalueinquotes="true"/>')},propsFunction:function(a){a.isRenderCondition=!0;var c,e,f=a.state,g=f.attr("fieldmodel"),h=[],i=!1,j=function(a,b){f.attr(a,b),i=!0},k=function(a){return"modelproperty"===a||"rowproperty"===a},l={id:"sourcetype",type:"picklist",label:"Source Type",defaultValue:"fieldvalue",picklistEntries:[{label:"Model field value",value:"fieldvalue"},{label:"Model property",value:"modelproperty"},{label:"Row property",value:"rowproperty"},{label:"Page/URL Parameter value",value:"param"},{label:"Running User attribute",value:"userinfo"}],onChange:function(c,d){d&&c!==d&&(k(c)&&k(d)&&f.removeAttr("sourceproperty"),u(a),a.save().refresh(),a.rebuildProps&&a.rebuildProps(),a.renderProperties&&a.renderProperties(b))}},m={id:"fieldmodel",type:"model",label:"Source Model",helptext:"The Model whose 1st row will be examined to see if it matches this Condition.",onChange:function(){a.refresh(),a.rebuildProps&&a.rebuildProps(),a.renderProperties&&a.renderProperties(b)}},n={id:"nosourcerowbehavior",type:"picklist",label:"If no rows in Model...",helptext:"Specifies the action to take if no rows are returned by the source model.",defaultValue:"deactivate",picklistEntries:[{label:"Ignore this Condition",value:"deactivate"},{label:"Skip other Conditions, and render",value:"skipandrender"},{label:"Skip other Conditions, and don't render",value:"skipandnorender"}]},o={id:"sourceparam",type:"string",label:"Parameter Name",onChange:function(){a.refresh()}},p={id:"sourceuserinfotype",type:"picklist",label:"User attribute",helptext:"The name of the property on the running User's record to compare against",defaultValue:"profileid",picklistEntries:[],onChange:function(){a.refresh()}},q={id:"sourceproperty",type:"picklist",label:"Model Property",defaultValue:"hasRows",picklistEntries:[{value:"data.length",label:"# of rows in Model"},{value:"hasNoRows",label:"Doesn't have data rows"},{value:"hasRows",label:"Has data rows"},{value:"hasChanged",label:"Has unsaved changes"},{value:"label",label:"Model label"},{value:"labelPlural",label:"Model plural label"}],onChange:function(c){"hasRows"===c||"hasNoRows"===c?f.removeAttr("type enclosevalueinquotes operator value"):("hasChanged"===c&&(f.attr("value")||f.attr({type:"fieldvalue",value:"true",enclosevalueinquotes:"false"})),u(a)),a.save().refresh(),a.rebuildProps&&a.rebuildProps(),a.renderProperties&&a.renderProperties(b)}},r={id:"sourceproperty",type:"picklist",label:"Row Property",defaultValue:"isNew",picklistEntries:[{value:"hasChanged",label:"Has unsaved changes"},{value:"isNew",label:"Is new record"},{value:"isSaved",label:"Is existing record in database"},{value:"isCloned",label:"Is unsaved clone of existing record"}],onChange:function(c){"isCloned"===c||"hasChanged"===c?f.attr("value")||f.attr({type:"fieldvalue",value:"true",enclosevalueinquotes:"false"}):f.removeAttr("type enclosevalueinquotes operator value"),u(a),a.save().refresh(),a.rebuildProps&&a.rebuildProps(),a.renderProperties&&a.renderProperties(b)}};if(jb.each(lb.userinfomap,function(a,b){p.picklistEntries.push({label:b.label,value:a})}),g)e=g;else if(d)e=d,j("fieldmodel",e);else{var s=lb.getLastSelectedModelComponent();e=s&&s.state?s.state.attr("id"):y().children().first().attr("id"),j("fieldmodel",e)}var t=f.attr("sourcetype")||"fieldvalue",v=k(t),w="rowproperty"===t,x=f.attr("sourceproperty"),z=f.attr("value");v&&(x||(x=w?r.defaultValue:q.defaultValue,j("sourceproperty",x)),w&&-1!==jb.inArray(x,["isCloned","hasChanged"])?("undefined"==typeof z&&j("value","true"),"false"!==f.attr("enclosevalueinquotes")&&j("enclosevalueinquotes","false")):w||-1===jb.inArray(x,["data.length","hasChanged"])||("undefined"==typeof z&&"hasChanged"===x&&j("value","true"),"false"!==f.attr("enclosevalueinquotes")&&j("enclosevalueinquotes","false"))),i&&(i=!1,a.save().refresh()),h.push(l),c=lb.getMetadataForField(a);var A={showObjectPickerIfPolymorphic:!0,addFieldToModel:!0,handleChange:function(){a.rebuildProps&&a.rebuildProps(),a.renderProperties&&a.renderProperties(b)}};f.attr("fieldmodel")?A.modelprop="fieldmodel":A.modelname=e;var B=[m],C={fieldvalue:B,modelproperty:[m,q],rowproperty:[m,r],param:[o],userinfo:[p]};return d&&d===e||B.push(n),B.push(lb.getConditionFieldPropObj(a,A)),jb.each(C[t],function(){h.push(this)}),v&&-1!==jb.inArray(x,["hasRows","hasNoRows","hasChildRows","hasNoChildRows","isNew","isSaved"])?h:(h.push(lb.getConditionOperatorPropObj(a,{fieldMetadata:c})),h.concat(lb.getConditionValueProperties(a,{handleRefresh:function(){a.rebuildProps&&a.rebuildProps(),a.renderProperties&&a.renderProperties(b)},handleChange:function(){a.refresh()},validTypes:-1!==jb.inArray(x,["isCloned","hasChanged"])?["fieldvalue"]:["fieldvalue","multiple","blank","userinfo","param"]})))}}]}}}function _(a){var b={id:"id",type:"string",label:"Label Id"};return a&&a.onChange&&(b.onChange=a.onChange),[b]}function ab(a){var b=a.attr("location"),c={};return"external"===b?jb.extend(c,{prefix:"(External)",name:a.attr("name")||a.attr("url")}):(c.name=a.attr("name"),c.prefix="(","inlinesnippet"===b?c.prefix+="Snippet":"inlinecomponent"===b?c.prefix+="Component":"inline"===b?c.prefix+="Inline":"staticresource"===b&&(c.prefix+="Static Resource"),c.prefix+=")"),c}function bb(a){var b=a.state,c={id:"location",type:"picklist",label:"Resource Location",defaultValue:"staticresource",picklistEntries:[{label:"Static Resource",value:"staticresource"},{label:"External",value:"external"},{label:"In-Line",value:"inline"},{label:"In-Line (Snippet)",value:"inlinesnippet"},{label:"In-Line (Component)",value:"inlinecomponent"}],onChange:function(c,d){"staticresource"===c?(b.attr("url",""),b.attr("cachelocation","false")):"external"!==c&&b.attr("url",""),c&&mb.startsWith(c,"inline")&&d&&d!==c&&(b.text()&&b.text()!==Rb[d]||b.text(Rb[c]),b.attr("name")&&b.attr("name")!==Sb[d]||b.attr("name",Sb[c])),a.save().refresh(),a.rebuildProps&&a.rebuildProps()}},d={id:"name",type:"string",label:"Resource Name",onChange:function(){a.refresh()}},e={type:"code",syntax:"javascript",label:"Resource Body",divisionSize:"2"},f={id:"name",type:"string",label:"Snippet Name",onChange:function(){a.refresh()}},g={type:"code",syntax:"javascript",label:"Snippet Body",divisionSize:"2"},h={id:"name",type:"string",label:"Component Name",onChange:function(){a.refresh()}},i={type:"code",label:"Component Body",syntax:"javascript",divisionSize:"2"},j={id:"namespace",type:"string",label:"Namespace (if in managed package)",helptext:"ONLY needed if this StaticResource is included in a Managed Package."},k={id:"name",type:"string",label:"Resource Name (optional)",onChange:function(){a.refresh()}},l={id:"url",type:"string",label:"Resource URL",divisionSize:"2",onChange:function(){a.refresh()}},m={id:"cachelocation",type:"boolean",label:"Cache Resource Location",helptext:"Leave UNCHECKED unless the contents of your Static Resource are very stable and will not be changing."},n={id:"filepath",type:"string",label:"File Path (within Static Resource)",helptext:"The desired file's relative location within the Static Resource.",divisionSize:"2"},o={external:[c,k,l],inline:[c,d,e],inlinesnippet:[c,f,g],inlinecomponent:[c,h,i],staticresource:[c,d,j,m,n],DEFAULT:[c,d,j]};return o[a.state.attr("location")||"DEFAULT"]}function cb(a){return a.attr("name")||a.attr("url")||"[No CSS Item Name]"}function db(a){var b={id:"location",type:"picklist",label:"Resource Location",defaultValue:"staticresource",picklistEntries:[{label:"Static Resource",value:"staticresource"},{label:"External",value:"external"},{label:"In-Line",value:"inline"}],onChange:function(b){"staticresource"===b?(a.state.attr("url",""),a.state.attr("cachelocation","true")):"external"!==b&&a.state.attr("url",""),a.refresh(),a.rebuildProps&&a.rebuildProps()}},c={id:"name",type:"string",label:"Resource Name",onChange:function(){a.refresh()}},d={id:"namespace",type:"string",label:"Namespace (if in managed package)",helptext:"ONLY needed if this StaticResource is included in a Managed Package."},e={id:"name",type:"string",label:"Resource Name (optional)",onChange:function(){a.refresh()}},f={id:"url",type:"string",label:"Resource URL",divisionSize:"2",onChange:function(){a.refresh()}},g={type:"code",syntax:"css",label:"Resource Body",divisionSize:"2"},h={id:"cachelocation",type:"boolean",label:"Cache Resource Location",helptext:"Leave UNCHECKED unless the contents of your Static Resource are very stable and will not be changing."},i={id:"filepath",type:"string",label:"File Path (within Static Resource)",helptext:"The desired file's relative location within the Static Resource.",divisionSize:"2"},j={external:[b,e,f],inline:[b,c,g],staticresource:[b,c,d,h,i],DEFAULT:[b,c,d]};return j[a.state.attr("location")||"DEFAULT"]}function eb(a){var b,c;switch(a.attr("type")){case"multiselect":case"select":c=a.attr("filteroffoptionlabel");var d=a.attr("conditionfield");return b="auto"===a.attr("conditionsource")?d?c?c:d:"(No field selected)":("true"===a.attr("createfilteroffoption")&&c?c:"Filter")+(a.attr("condition")?" - "+a.attr("condition"):"");case"toggle":return a.attr("label")||"Filter";case"daterange":return b="Range: ","auto"===a.attr("conditionsource")?b+=a.attr("conditionfield")||"(No field selected)":a.attr("startcondition")&&a.attr("endcondition")&&(b+=a.attr("startcondition")+" <-> "+a.attr("endcondition")),b}}function fb(a){var b,c,d,e=a.state,f=e.attr("conditionsource"),g=e.attr("type"),h=e.attr("conditionfield"),i="false"!==e.attr("affectcookies"),j=function(){h&&b&&(c=s(b,h),d=c?c.displaytype:!1)};f||(f=g?"manual":"auto"),"auto"===f&&h&&i&&(sc(e,b),a.save()),a.modelName||(a.modelName=hb(e)),b=a.modelName,j();var k,l=g+"_"+f,m={id:"type",type:"picklist",label:"Filter Type",defaultValue:"select",picklistEntries:[{label:"Date Range",value:"daterange"},{label:"Multi-select Option",value:"multiselect"},{label:"Select Option",value:"select"},{label:"Toggle",value:"toggle"}],onChange:function(c,d){e.removeAttr("conditionoperator"),e.empty(),a.element.children(".nx-childwrapper").empty(),"auto"===e.attr("conditionsource")&&"toggle"!==d&&tc(e,b),"toggle"===c&&"toggle"!==d?e.attr("conditionsource","manual"):"multiselect"===c&&"multiselect"!==d&&e.attr("conditionsource","auto"),"auto"===e.attr("conditionsource")&&"false"!==e.attr("affectcookies")&&e.attr("conditionfield")&&sc(e,b),a.save().refresh(),a.rebuildProps&&a.rebuildProps()}},n={id:"condition",label:"Model Condition to Affect",helptext:"The Condition on this Model whose values this Filter will affect by default -- unless specified otherwise in the Effects of this Filter's options.",modelName:b,type:"condition",onChange:function(b,c){a.refresh(),c&&jb.removeCookie(pb.getConditionCookieName(a.modelName,c,kb.pagebuilderui.row.Id)),a.rebuildProps()}},o={id:"conditionsource",type:"picklist",label:"Condition Source",defaultValue:"auto",picklistEntries:[{label:"Auto Generate Conditions",value:"auto"},{label:"Specify Existing Conditions",value:"manual"}],onChange:function(c,d){d&&d!==c&&("auto"===c&&e.attr("conditionfield")&&"false"!==e.attr("affectcookies")?sc(e,b):"manual"===c&&tc(e,b),a.save().refresh(),a.rebuildProps&&a.rebuildProps())}},p={id:"conditionsource",type:"picklist",label:"Pick Options and Condition(s)",defaultValue:"auto",picklistEntries:[{label:"Automatically",value:"auto"},{label:"Manually",value:"manual"}],onChange:function(c,d){d&&d!==c&&("auto"===c&&e.attr("conditionfield")&&"false"!==e.attr("affectcookies")?sc(e,b):"manual"===c&&(tc(e,b),"auto"===e.attr("labelmode")&&e.removeAttr("labelmode")),e.removeAttr("conditionoperator"),a.save().refresh(),a.rebuildProps&&a.rebuildProps())}},q={id:"conditionfield",type:"field",label:"Date/Datetime Field",displayTypeFilter:[Ab,Bb],addFieldToModel:!1,modelname:b,onChange:function(c,d,f,g){g&&"[No Field Selected]"!==g?(uc(e,b,g),a.save()):(sc(e,b),a.save()),a.refresh()}},r={id:"conditionfield",type:"field",label:"Filter Field",displayTypeFilter:[Ib,Fb,Jb],addFieldToModel:!1,modelname:b,onChange:function(c,d,f,g){g&&"[No Field Selected]"!==g?(uc(e,b,g),a.save()):(sc(e,b),a.save()),a.refresh().rebuildProps()}},t={id:"startcondition",label:"Begin Model Condition",modelName:b,type:"condition",onChange:function(c,d){a.refresh(),d&&jb.removeCookie(pb.getConditionCookieName(b,d,kb.pagebuilderui.row.Id))}},u={id:"endcondition",label:"End Model Condition",modelName:b,type:"condition",onChange:function(c,d){a.refresh(),d&&jb.removeCookie(pb.getConditionCookieName(b,d,kb.pagebuilderui.row.Id))}},v={id:"affectcookies",label:"Remember last-selected filter value in cookies",helptext:"By default, Skuid will remember, for each user, the filter value that the user most recently selected. The value is stored a session cookie. Uncheck to disable this functionality.",type:"boolean",defaultValue:!0,onChange:function(c){var d=e.attr("conditionfield")&&"auto"===e.attr("conditionsource");d&&(c===!0?sc(e,b):tc(e,b),a.save()),a.refresh().rebuildProps()}},w={id:"createfilteroffoption",label:'Create "None Selected" Option',helptext:"If checked, an option which turns off this filter will be added to the options list.",type:"boolean",onChange:function(){a.refresh().rebuildProps()}},x={id:"filteroffoptionlabel",label:'"None Selected" Option Text',type:"string",helptext:'If desired, you can change the text of the "Filter Off" option, to be something like "Any Status", "Any Record Type", etc.',defaultValue:"Any",onChange:function(){a.refresh()}},y={id:"labelmode",label:"Show Label above Filter",type:"picklist",helptext:"If desired, an always-visible label will be shown above this filter.",defaultValue:"no",picklistEntries:[{label:"Yes, use Field's label",value:"auto"},{label:"Yes, use custom label",value:"manual"},{label:"No",value:"no"}],onChange:function(){a.rebuildProps()}},z={id:"label",label:"Filter Label",type:"string",onChange:function(){a.refresh()}},A={id:"autocompthreshold",label:"Switch Filter to Autocomplete at X Items",type:"number",defaultValue:"25",helptext:"By default, Select Option filters will become Autocompletes when the count of items in their list reaches 25. Change this amount if you'd like that to happen at a higher or lower number."},C=function(){"manual"===e.attr("labelmode")&&k.push(z)};switch(l){case"toggle_manual":return[m,z,v];case"daterange_auto":return k=[m,o,q,y],C(),k;case"daterange_manual":return y.picklistEntries[0].label="Yes, use Condition's Field's label",k=[m,o,v,t,u,y],C(),k;case"multiselect_auto":return k=[m,r],c&&d&&k.push(lb.getConditionOperatorPropObj(a,{id:"conditionoperator",label:"Filter Condition Operator",conditionType:"multiple",fieldMetadata:c,handleChange:function(c){var d=qc(e.attr("conditionfield")),f=B(d,b);f&&f.length&&(f.attr("operator",c),a.save())},defaultValue:"MULTIPICKLIST"===d?"includes":"in"})),k.push(v,y),C(),k.push(x),k;case"select_manual":return e.attr("condition")?y.picklistEntries[0].label="Yes, use Condition's Field's label":y.picklistEntries.splice(0,1),k=[m,p,n,v,A,y],C(),k.push(w),"true"===e.attr(w.id)&&k.push(x),k;default:return k=[m,p,r,v],"REFERENCE"!==d&&k.push(A),k.push(y),C(),k.push(x),k
}}function gb(a){var b,c=a.attr("action");return b="set"===c?(a.attr("condition")||"[No Condition]")+" --> "+a.attr("value"):("activate"===c?"Activate ":"Deactivate ")+(a.attr("condition")||"[No Condition]")}function hb(a){var b,c=a.closest("skootable, queue, eventview");return c.is("skootable, queue")?b=c.attr("model"):c.is("eventview")&&(b=c.attr("groupingmodel")),b}function ib(a){var b=a.state;a.modelName=hb(b);var c={id:"action",type:"picklist",label:"Action",defaultValue:"activate",picklistEntries:[{label:"Activate and Set Value",value:"set"},{label:"Activate",value:"activate"},{label:"De-Activate",value:"deactivate"}],onChange:function(){a.refresh().rebuildProps()}},d={id:"condition",label:"Model Condition",modelName:a.modelName,type:"condition",onChange:function(b,c){a.refresh(),c&&jb.removeCookie(pb.getConditionCookieName(a.modelName,c,kb.pagebuilderui.row.Id))}},e=[c,d],f=b.parent().parent(),g=f&&f.is("source");return"set"===b.attr("action")&&(g&&"model"===f.attr("type")?e.push({id:"value",label:"Value to inject into Condition",type:"template",location:"attribute",displayAs:"input",defaultValue:"{{Id}}",onChange:function(){a.refresh()}}):g&&"metadata"===f.attr("type")||e.push({id:"value",label:"Value",type:"string",onChange:function(){a.refresh()}})),e}var jb=a.$,kb=a.builder={},lb=kb.core={},mb=a.utils,nb=mb.makeXMLDoc,ob=a.snippet,pb=a.model,qb=a.events.publish,rb={},sb={},tb=jb(),ub={},vb=function(){return lb.fieldsDescribeCache?(jb.each(lb.fieldsDescribeCache,function(a,b){mb.createMapForArray([b],"fields","fieldsMap",["id","name"])}),!0):!1},wb="BASE64",xb="BOOLEAN",yb="COMBOBOX",zb="CURRENCY",Ab="DATE",Bb="DATETIME",Cb="DOUBLE",Db="EMAIL",Eb="INTEGER",Fb="MULTIPICKLIST",Gb="PERCENT",Hb="PHONE",Ib="PICKLIST",Jb="REFERENCE",Kb="STRING",Lb="TEXTAREA",Mb="TIME",Nb="URL";jb(function(){vb()||jb(document.body).one("pageload",function(){vb()})});var Ob=/[^A-Za-z0-9_]+/g,Pb=/[^A-Za-z0-9_]+/g,Qb=/[^A-Za-z0-9_]+/g;lb.validators={modelId:function(a,b){if(Ob.test(a))return"Model Ids can only contain letters, numbers, or underscores.";var c=z(a);return c.length&&c[0]!==b[0]?"There is already another Model with this name.":!0},conditionName:function(a,b){if(Pb.test(a))return"Condition Names can only contain letters, numbers, or underscores.";var c=B(a,b.state.closest("model").attr("id"));return c.length&&c[0]!==b[0]?'There is already another Condition with the name "'+a+'" on this Model."':!0},alphaNumericUnder:function(a,b){b||(b={});var c=b.description||"Input";return Qb.test(a)?c+" may only contain letters, numbers, or underscores.":!0},uniqueAttribute:function(a,b,c){c||(c={}),c.hasOwnProperty("attribute")===!1&&(c.attribute="id");var d=!0,e=c.description||"item",f=c.attributeDescription||"value";return c.hasOwnProperty("nodeList")===!0&&jb.each(c.nodeList,function(){var g=jb(this);return g.attr(c.attribute)===a&&g!==b.state?(d="There is already another "+e+" with the "+f+" of "+a,!1):void 0}),d},numericOnly:function(a){return mb.isNumber(a)===!1?"Must contain a numeric value":!0}};var Rb={inline:"(function(skuid){\n	var $ = skuid.$;\n	$(function(){\n		var myModel = skuid.model.getModel('MyModelId');\n		var myComponent = skuid.component.getById('MyComponentUniqueId');\n	});\n})(skuid);",inlinesnippet:"var params = arguments[0],\n	$ = skuid.$;\n",inlinecomponent:"var element = arguments[0],\n	$ = skuid.$;\n\nelement.html('Hello <b>world!</b>');"},Sb={inline:"newInlineJS",inlinesnippet:"newSnippet",inlinecomponent:"newComponent"};lb.defaultStateGenerators={model:function(){return nb('<model id="'+b()+'" limit="20" query="true" createrowifnonefound="false"/>')},field:function(a){var b="string"==typeof a,d=b?a:a.id,e=nb('<field id="'+d+'"/>');if(!b&&a.needsAlias){var f=a.functionName;e.attr("name",a.alias?a.alias:c(d,f)),f&&e.attr("function",f)}return a.isRelationship&&e.attr({type:"childRelationship",limit:"10"}),e},label:function(a){return nb("<label"+(a?' id="'+a+'"':"")+"/>")},jsitem:function(){return nb('<jsitem location="inlinesnippet" name="newSnippet" cachelocation="false"/>').text(Rb.inlinesnippet)},cssitem:function(){return nb('<cssitem location="inline" name="newcss" cachelocation="false"/>')},javascript:function(){return nb("<javascript/>")},labels:function(){return nb("<labels/>")},css:function(){return nb("<css/>")}},lb.coreProps={uniqueIdProp:function(a){var b={id:"uniqueid",type:"string",label:"Unique Id",helptext:"Optional parameter that gives this component's DOM element an id property."};return jb.extend(b,a||{})},cssClassProp:function(a){var b={id:"cssclass",type:"string",label:"CSS Class",helptext:"Optional parameter that gives this component's DOM element a CSS class."};return jb.extend(b,a||{})}},ob.registerSnippet("skuid.builder.page.preview",function(b){var c,d,e=b.model,f=b.row||e.getFirstRow(),g=b.saveFirst===!0,h=b.editor,i=jb("body"),j=!1,k=!1,l=function(b){a.mobile||(d=window.open(b||""))},m=function(b,c){var e="/apex/skuid__ui?page="+b.Name+(c?c:"");a.mobile?mb.redirect({url:e,title:"Page: "+b.Name}):d?d.location=e:l(e)},n=function(){var b=jb("<div>").addClass("nx-basicfieldeditor nx-editor-contents");a.mobile,b.append(jb("<div>").css({border:"solid 1px #ddd",backgroundColor:"#efefef",padding:"6px",marginBottom:"10px"}).html("Click Go to preview the page '"+f.Name+"'"+(a.mobile?"":" in a new window")));var c=function(){m(f)},d="Preview Page: "+f.Name;b.dialog({width:300,height:200,title:d,resizable:!1,modal:!0,close:function(){jb(this).remove()},buttons:[{text:"Go",id:"PreviewWindowGo",click:function(){c(),jb(this).remove()}},{text:"Cancel",id:"PreviewWindowCancel",click:function(){jb(this).remove()}}]})},o=function(){var b=c.children("models").find('condition[type="param"]');if(b.length){var d={},e={},h=[];b.each(function(){var a=jb(this),b=a.attr("value");if(!b||b.toLowerCase()in d||"true"===a.attr("inactive"))return!0;var c,f,g=a.closest('condition[type="join"][joinobject]'),i=a.attr("field");if(g.length?f=g.attr("joinobject"):(c=a.closest("model"),f=c.attr("sobject")),f){var j=lb.fieldsDescribeCache[f],k=!j,l=i&&j&&j.fieldsMap&&!j.fieldsMap[i];k?e[f]={}:l&&(e[f]=jb.extend({},j)),i&&(k||l)&&(e[f][i]=1)}h.push(a)});var l=function(){jb.each(h,function(){var a,b=jb(this),c=b.attr("value"),e=b.attr("field"),f=b.closest('condition[type="join"][joinobject]'),g=b.closest("model");a=f.length?f.attr("joinobject"):g.attr("sobject");var h,i=jb.extend(!0,{},s(g,e,a));if("ID"===i.displaytype){var j=c+"__FakeLookup";i.id=j+"__c",e=i.id,jb.extend(i,{editable:!0,filterable:!0,displaytype:Jb,ref:a,rel:j+"__r"}),h={id:i.rel+"."+mb.getNameField(a)}}else i.displaytype===Jb?h={id:i.rel+"."+mb.getNameField(i.rel)}:i.displaytype===Ib&&(i.displaytype="TEXT");i.createable=!0,i.editable=!0,!c||c.toLowerCase()in d||(d[c.toLowerCase()]={field:e,fieldInfo:i,refInfo:h,sobject:a})});var b=jb("<div>").addClass("nx-basicfieldeditor nx-editor-contents").prepend(jb("<div>").css({border:"solid 1px #ddd",backgroundColor:"#efefef",padding:"6px",marginBottom:"10px"}).html('A condition was set for this page that references a URL parameter. Please provide a sample value for that URL Parameter so that the Page will behave appropriately.<br/><br/>If the Parameter is on a Reference field, please enter the Name (e.g. "ACME"), not the Id, in the Autocomplete. Skuid will grab the related record and use its Id for the preview.'));jb.each(d,function(c){var d=jb("<div>").addClass("nx-basicfieldeditor-item nx-pagebuilder-property-item");b.append(d);var e=jb("<div>").addClass("nx-basicfieldeditor-item-label").text(c+(this.fieldInfo.ref?" ("+(-1!==this.fieldInfo.ref.indexOf(",")?"multiple objects":this.fieldInfo.ref)+")":""));d.append(e),pb.registerModel("tempModelPreview",{fields:this.refInfo?[this.fieldInfo,this.refInfo]:[this.fieldInfo],data:[],conditions:[],createRowIfNoneFound:!0,objectName:this.sobject});var f=pb.getModel("tempModelPreview");pb.initializeModel(f);var g;g=this.fieldInfo&&this.fieldInfo.ref&&-1===this.fieldInfo.ref.indexOf(",")?mb.getNameField(this.fieldInfo.ref):"Name";var h=f.getFirstRow(),i={fieldId:this.field,mode:"edit",useSOSLSearch:!0,SOSLFields:"Name Fields",tokenizeSearch:"true"},j=new a.ui.Field(h,f,!1,i);j.metadata=this.fieldInfo,j.element.addClass("nx-previewfield").data("param",c),j.render(),d.append(j.element)});var c=function(a){var c=b.find(".nx-previewfield"),d="",e=[];c.each(function(){var a=jb(this).data("param"),b=jb(this).data("object"),c=b.row[b.id];return!c||c&&b&&-1!==jb.inArray(b,["ID",Jb])&&c.length<15?(e.push("Please select a value for Parameter "+a),!0):void(c&&(d+="&"+a+"="+encodeURIComponent(c)))});var g=b.find(".nx-messages");e.length?(g.length?g.empty():g=jb('<div class="nx-messages"/>').appendTo(b),jb.each(e,function(){g.append(jb('<div class="nx-property-error">'+this+"</div><br/>"))})):(m(f,d),g.length&&g.empty().hide(),a.remove())},e="Set Parameters needed to View Page: "+f.Name;b.dialog({width:500,height:400,title:e,resizable:!1,modal:!0,close:function(){jb(this).remove()},buttons:[{text:"Go",id:"PreviewWindowGo",click:function(){c(jb(this))}},{text:"Cancel",id:"PreviewWindowCancel",click:function(){jb(this).remove()}}]})},o=jb.Deferred(),p=mb.size(e);p?(j=!0,i.block({message:"Retrieving metadata for fields associated with URL Parameter Conditions..."}),jb.each(e,function(a){a&&lb.getFields(a,function(){delete e[a],mb.size(e)||o.resolve()})})):o.resolve(),jb.when(o).then(function(){p&&i.unblock(),l()})}else j||k||g?n():m(f)},p=jb.Deferred();if(b.xml)c=b.xml,p.resolve();else{var q,r=!0;jb.each(lb.layoutFields,function(a,b){return e.getField(b)?void 0:(r=!1,!1)}),r?p.resolve():(k=!0,i.block({message:"Loading page layout data to check for required parameters..."}),q=new pb.Model({objectName:e.objectName,conditions:[{field:"Id",value:f.Id}],doQuery:!0,id:"TempPageLayoutFieldsModel"+(new Date).getTime()}),jb.each(e.fields,function(a,b){q.fields.push({id:b.id})}),jb.each(lb.layoutFields,function(a,b){e.getField(b)||q.fields.push({id:b})}),q.initialize(),p=q.updateData())}jb.when(p).then(function(){if(q&&(f=e.adoptRow(q.getFirstRow(),{notify:!1}),i.unblock()),!c){var a=e.getFieldValues(f,lb.layoutFields,!0).join("");if(!a)return void window.alert("This page does not have any layout yet. Please continue building your page before previewing.");c=nb(a)}if(g){i.block({message:"Saving Page..."});var b=function(a){i.unblock(),a.totalsuccess&&o()};h?h.save({callback:function(a){b(a)}}):e&&e.save({callback:function(a){b(a)}})}else o()})}),d.prototype.renderComponent=function(a,b){this.componentRenderer?this.componentRenderer(a,b):e(a,b)},d.prototype.renderProperties=function(a,b){this.propertiesRenderer?this.propertiesRenderer(a,b):f(a,b)},d.prototype.getDefaultState=function(a){return this.defaultStateGenerator?this.defaultStateGenerator(a):nb("<"+this.id+"/>")};var Tb={},Ub=["NUMBER",Eb,xb,zb,Ab,Bb,Cb,Gb],Vb=[Kb,Lb,Hb,Db,Ib,Nb,yb,wb],Wb=[Kb,Lb,Hb,Db,Ib,Nb,yb,wb,Ab,Bb,Cb,Eb,Gb,zb,Mb],Xb={name:"=",longname:"is",validFor:["fieldvalue","param","userinfo","blank","modelmerge","dependent","searchfield"]},Yb={"data.length":Eb,hasChildRows:xb,hasNoChildRows:xb,hasRows:xb,hasNoRows:xb,hasChanged:xb,isNew:xb,isCloned:xb,isSaved:xb},Zb={"":Xb,"=":Xb,"!=":{name:"!=",longname:"is not",validFor:["fieldvalue","param","userinfo","blank","modelmerge","dependent"]},gt:{name:">",longname:"is greater than",validFor:["fieldvalue","param","userinfo","modelmerge","dependent"],validForDisplayTypes:Wb},lt:{name:"<",longname:"is less than",validFor:["fieldvalue","param","userinfo","modelmerge","dependent"],validForDisplayTypes:Wb},gte:{name:">=",longname:"is greater than or equal to",validFor:["fieldvalue","param","userinfo","modelmerge","dependent"],validForDisplayTypes:Wb},lte:{name:"<=",longname:"is less than or equal to",validFor:["fieldvalue","param","userinfo","modelmerge","dependent"],validForDisplayTypes:Wb},"in":{name:"in",longname:"is in the set of values",validFor:["modelmerge","multiple","join","search"]},"not in":{name:"not in",longname:"is not in the set of values",validFor:["modelmerge","multiple","join"]},includes:{name:"includes",longname:"includes one or more of these values",validFor:["fieldvalue","param","userinfo","modelmerge","dependent","multiple","searchfield"],validForDisplayTypes:[Fb]},excludes:{name:"excludes",longname:"does not include any of these values",validFor:["fieldvalue","param","userinfo","modelmerge","dependent","multiple"],validForDisplayTypes:[Fb]},"starts with":{name:"starts with",validFor:["fieldvalue","param","userinfo","modelmerge","dependent","searchfield"],validForDisplayTypes:Vb},"ends with":{name:"ends with",validFor:["fieldvalue","param","userinfo","modelmerge","dependent"],validForDisplayTypes:Vb},contains:{name:"contains",validFor:["fieldvalue","param","userinfo","modelmerge","dependent","searchfield"],validForDisplayTypes:Vb},"does not contain":{name:"does not contain",validFor:["fieldvalue","param","userinfo","modelmerge","dependent"],validForDisplayTypes:Vb},"does not start with":{name:"does not start with",validFor:["fieldvalue","param","userinfo","modelmerge","dependent"],validForDisplayTypes:Vb},"does not end with":{name:"does not end with",validFor:["fieldvalue","param","userinfo","modelmerge","dependent"],validForDisplayTypes:Vb}},$b={defaultcurrency:{label:"Default Currency"},firstname:{label:"First Name"},lastname:{label:"Last Name"},email:{label:"Email"},locale:{label:"Locale"},name:{label:"Name",value:"name"},organizationid:{label:"Organization Id"},organizationname:{label:"Organization Name"},profileid:{label:"Profile Id"},sessionid:{label:"Session Id"},userid:{label:"User Id"},username:{label:"User Name"},userroleid:{label:"User Role Id"},usertype:{label:"User Type"},ismulticurrencyorganization:{label:"Is Multi Currency Org"}},_b={YESTERDAY:{label:"Yesterday"},TODAY:{label:"Today"},TOMORROW:{label:"Tomorrow"},LAST_WEEK:{label:"Last Week"},THIS_WEEK:{label:"This Week"},NEXT_WEEK:{label:"Next Week"},LAST_MONTH:{label:"Last Month"},THIS_MONTH:{label:"This Month"},NEXT_MONTH:{label:"Next Month"},LAST_90_DAYS:{label:"Last 90 Days"},NEXT_90_DAYS:{label:"Next 90 Days"},LAST_N_DAYS:{label:"Last n Days",merge:!0},NEXT_N_DAYS:{label:"Next n Days",merge:!0},THIS_QUARTER:{label:"This Quarter"},LAST_QUARTER:{label:"Last Quarter"},NEXT_QUARTER:{label:"Next Quarter"},NEXT_N_QUARTERS:{label:"Next n Quarters",merge:!0},LAST_N_QUARTERS:{label:"Last n Quarters",merge:!0},THIS_YEAR:{label:"This Year"},LAST_YEAR:{label:"Last Year"},NEXT_YEAR:{label:"Next Year"},NEXT_N_YEARS:{label:"Next n Years",merge:!0},LAST_N_YEARS:{label:"Last n Years",merge:!0},THIS_FISCAL_QUARTER:{label:"This Fiscal Quarter"},LAST_FISCAL_QUARTER:{label:"Last Fiscal Quarter"},NEXT_FISCAL_QUARTER:{label:"Next Fiscal Quarter"},NEXT_N_FISCAL_QUARTERS:{label:"Next n Fiscal Quarters",merge:!0},LAST_N_FISCAL_QUARTERS:{label:"Last n Fiscal Quarters",merge:!0},THIS_FISCAL_YEAR:{label:"This Fiscal Year"},LAST_FISCAL_YEAR:{label:"Last Fiscal Year"},NEXT_FISCAL_YEAR:{label:"Next Fiscal Year"},NEXT_N_FISCAL_YEARS:{label:"Next n Fiscal Years",merge:!0},LAST_N_FISCAL_YEARS:{label:"Last n Fiscal Years",merge:!0}},ac=["Id","LastReferencedDate","LastViewedDate","Name","Type"],bc=["FirstName","LastName"],cc=function(a,b,c){var d,e;return c&&(d=c.modelPropId,e=c.component),d||(d="model"),"model.remove"===b.type&&a.attr(d)===b.modelId?(e?e.remove(!1,!0):a.remove(),qb("skuidBuilderNeedSave"),!0):!1},dc=function(a,b,c){return"model.idChange"===b.type&&a.attr(c||"model")===b.oldId?(a.attr(c||"model",b.newId),qb("skuidBuilderNeedSave"),!0):!1},ec=function(a,b){var c,d=l(a.prop("tagName"));d&&d.handleStateEvent&&(c=d.handleStateEvent(a,b)),c!==!1&&a.children().each(function(){ec(jb(this),b)})},fc={field:function(a,b){if("search"===a.attr("type"))return"Id";if(a.attr("field")){var c=a.attr("fieldfunction"),d=c&&"DISTANCE"===c;return b+" records where <b>"+(c&&!d?c.toUpperCase()+"(":"")+a.attr("field")+(c&&!d?")":"")+"</b>"}return"[No Field Selected]"},operator:function(a){var b="search"===a.attr("type")?"in":a.attr("operator")||"",c=lb.operatormap[b];return"<b>"+(c.longname||c.name)+"</b>"},value:function(a){var b,c=a.attr("type");if("fieldvalue"===c){b="<b>"+a.attr("value");var d=a.attr("units");d&&(b+=" "+("km"===d?"kilometers":"miles")+" from "),b+="</b>"}else if("multiple"===c)b="",a.children("values").children().each(function(){b+=jb(this).text()+", "}),b=b.substring(0,b.length-2);else if("param"===c)b=a.attr("value")?"the <b>"+a.attr("value")+" parameter</b> in the page's url":"[No Parameter Given]";else if("userinfo"===c){var e=lb.userinfomap[a.attr("userinfotype")],f=e?e.label:"User Id";b="the <b>"+f+"</b> of the user running this page"}else if("blank"===c)b="a <b>blank</b> value";else if("modelmerge"===c){var g=-1!==jb.inArray(a.attr("operator"),["in","not in"]);b=a.attr("mergefield")?(g?"containing":"the value of")+" the <b>"+a.attr("mergefield")+"</b> field from "+(g?"any":"the first")+" row returned by the <b>"+a.attr("model")+"</b> model":"[No Merge Field Selected]"}else"join"===c?b=a.attr("joinfield")?"specified by returning <b>"+a.attr("joinfield")+"</b> values from a subquery on the <b>"+a.attr("joinobject")+"</b> object":"[No Join Field Selected]":"search"===c&&(b="returned by searching <b>"+(a.attr("fieldfunction")||"Name Fields")+"</b> for '<b>"+a.attr("value")+"</b>'");return b},state:function(a){var b="This condition",c=a.attr("state");return c?"filterableon"===c||"filterableoff"===c?(a.attr("name")&&(b+=", named <b>"+a.attr("name")+"</b>"),b+=" can be modified by filters, but is <b>"+("filterableon"===c?"on":"off")+" by default</b>."):b+=" is <b>always off</b>":b+=" is <b>always on</b>.",b}},gc=[],hc=[{label:"Alt",value:"alt"},{label:"Ctrl",value:"ctrl"},{label:"Command",value:"meta"},{label:"Shift",value:"shift"}],ic={disabled:!0,label:"",value:""},jc=function(a){return{disabled:!0,label:a,value:""}},kc=[jc("Letters/Numbers")];jb.each("ABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890".split(""),function(a,b){kc.push({label:b,value:b.toLowerCase()})}),kc.push(ic,jc("Arrow Keys")),jb.each(["Left","Up","Right","Down"],function(){kc.push({label:this,value:this.toLowerCase()})}),kc.push(ic,jc("Special Keys")),jb.each([{l:"Backspace/Delete",v:"backspace"},{l:"Delete Right",v:"del"},{l:"End",v:"end"},{l:"Home",v:"home"},{l:"Page Down",v:"pagedown"},{l:"Page Up",v:"pageup"},{l:"Return",v:"return"},{l:"Space",v:"space"},{l:"Tab",v:"tab"}],function(){kc.push({label:this.l,value:this.v})}),kc.push(ic,jc("Function Keys"));for(var lc=1;13>lc;lc++)kc.push({label:"F"+lc,value:"f"+lc});var mc={},nc="sk-icon",oc=function(a){return"__autofilter__start__"+a},pc=function(a){return"__autofilter__end__"+a},qc=function(a){return"__autofilter__"+a},rc=function(a){a||(a={});var b,c,d,e=a.currentOperator,f=a.filterType,g=a.fieldName,h=a.modelName,i="multiselect"===f;return i?(h&&g&&(b=s(h,g),c=b?b.displaytype:!1,c&&(d=H({type:"multiple",displayType:c}))),d&&e&&e in d?e:"MULTIPICKLIST"===c?"includes":"in"):"="},sc=function(a,b){var c=a.attr("type"),d=a.attr("conditionfield"),e=z(b),f=e.children("conditions");if(f.length)if("daterange"===c){var g=oc(d);B(g,f).length||f.append(nb("<condition/>").attr({type:"fieldvalue",field:d,operator:"gte",inactive:"true",enclosevalueinquotes:"false",name:g,state:"filterableoff",value:""}),nb("<condition/>").attr({type:"fieldvalue",field:d,operator:"lte",inactive:"true",enclosevalueinquotes:"false",name:pc(d),state:"filterableoff",value:""}))}else if(mb.contains(c,"select")){var h=qc(d),i="multiselect"===c;B(h,f).length||f.append(nb("<condition/>").attr({type:i?"multiple":"fieldvalue",field:d,operator:rc({fieldName:d,modelName:b,currentOperator:a.attr("conditionoperator"),filterType:c}),inactive:"true",enclosevalueinquotes:"true",name:h,state:"filterableoff",value:""}))}},tc=function(a,b){var c=a.attr("type"),d=a.attr("conditionfield"),e=z(b),f=e.children("conditions").children();if(f.length)if("daterange"===c){var g=oc(d),h=pc(d);jb.removeCookie(pb.getConditionCookieName(b,g,kb.pagebuilderui.row.Id)),jb.removeCookie(pb.getConditionCookieName(b,h,kb.pagebuilderui.row.Id)),f.each(function(){var a=jb(this),b=a.attr("name");(b===g||b===h)&&a.remove()})}else if(mb.contains(c,"select")){var i=qc(d);jb.removeCookie(pb.getConditionCookieName(b,i,kb.pagebuilderui.row.Id)),f.each(function(){var a=jb(this);return a.attr("name")===i?(a.remove(),!1):void 0})}},uc=function(a,b,c){var d=a.attr("type"),e=a.attr("conditionfield"),f=z(b),g=f.children("conditions").children();if(g.length)if("daterange"===d){var h=oc(c),i=pc(c),j=oc(e),k=pc(e),l=!1,m=!1;g.each(function(){var a=jb(this),c=a.attr("name"),d=c===h,f=c===i;(d||f)&&(d?(l=!0,a.attr("name",j)):f&&(m=!0,a.attr("name",k)),a.attr("field",e),jb.removeCookie(pb.getConditionCookieName(b,c,kb.pagebuilderui.row.Id)))}),l&&m||sc(a,b)}else if(mb.contains(d,"select")){var n=qc(c),o=qc(e),p=!1;g.each(function(){var c=jb(this);return c.attr("name")===n?(p=!0,c.attr({name:o,field:e,operator:rc({fieldName:e,modelName:b,currentOperator:a.attr("conditionoperator"),filterType:d})}),jb.removeCookie(pb.getConditionCookieName(b,n,kb.pagebuilderui.row.Id)),!1):void 0}),p||sc(a,b)}};lb.removeModelConditionsForAutoFilter=tc;var vc=!1;a.events.subscribe("skuidBuilderNeedSave",function(){vc=!0}),a.events.subscribe("skuidBuilderComponentNeedsRefresh",function(a){ub[a._GUID]=a});var wc,xc=function(a){lb.pageXML&&(jb.each(i(),function(b,c){var d,e=c.builder;e&&(d=e.handleStateEvent,d&&d(c.state,a,c))}),ec(lb.pageXML,a),vc&&(vc=!1,qb("skuidBuilderSave")))},yc=function(){if(wc&&wc.state){var a=z(wc.state.attr("id"));if(a&&a.length)return wc}return wc=null},zc=function(a){wc=a},Ac=function(a,b){var c,d,e=[],f=[],g="multipicklist"==a.type,h=a.id,i=a.storeAs;if(!g||i&&"node"!==i.type)c=b.attr(h),d=c&&"undefined"!=c,d&&f.push(c);else{var j=b.children(h);c="",d=j.length,d&&i&&"node"===i.type&&(jb.each(j.children(i.name),function(){f.push(jb(this).text())}),c=f.join(","))}return y().children().each(function(b){var c=jb(this).attr("id"),d=-1!==jb.inArray(c,f),g=a.objectTypeFilter,h=lb.getSObjectNameFromModelName(c);if(g)if("string"==typeof g){if(h!==a.objectTypeFilter)return!0}else if("function"==typeof g&&!g({sobjectName:h,modelId:c,modelOrder:b,isSelected:d}))return!0;e.push({value:c,label:c})}),e},Bc={models:function(a,b,c){return a.type="multipicklist",a.storeAs||(a.storeAs={type:"node",name:"model"}),a.location||(a.location="node"),a.noneSelectedText||(a.noneSelectedText="Select Models..."),a.picklistEntries=Ac(a,b),Bc.multipicklist(a,b,c)},model:function(b,c){var d,e=b.id,f=c.attr(e),g=f&&"undefined"!=typeof f,h=Ac(b,c);return!g&&h.length&&(f=h[0].value,g=f&&"undefined"!=typeof f,f&&g&&lb.updateState(c,{key:e,value:f})),d=a.ui.renderers.PICKLIST.edit({value:f,entries:h,required:!0,onChange:function(a,d){lb.updateState(c,{key:e,value:a}),b.onChange&&b.onChange(a,!1,d)}})},"boolean":function(b,c){var d,e,f=b.id;return d="true"===c.attr(f)?!0:c.attr(f)?!1:b.defaultValue||!1,e=a.ui.renderers.BOOLEAN.edit({value:d,onChange:function(a){lb.updateState(c,{key:f,value:a}),b.onChange&&b.onChange(a)}}),b.readonly&&e.prop("disabled",!0),e},condition:function(b,c){var d,e=b.id;if(b.modelName){var f=y().children('[id="'+b.modelName+'"]'),g=f.children("conditions").find("[name]");d=g.map(function(){var a=jb(this).attr("name");return mb.startsWith(a,"__autofilter__")?void 0:{value:a,label:a}})}return a.ui.renderers.PICKLIST.edit({value:c.attr(e),entries:d,onChange:function(a){var d=c.attr(e);lb.updateState(c,{key:e,value:a}),b.onChange&&b.onChange(a,d)},noneLabel:"--None--"})},picklist:function(b,c){var d,e,f,g="multipicklist"==b.type,h=b.id,i=b.storeAs,j=b.options||b.picklistEntries,k=[],l=function(a){var b;g&&i&&"node"===i.type?(b={childNodeName:h,storeAs:i,value:a?a.split(","):[]},k=b.value):b={key:h,value:a||""},lb.updateState(c,b),f=!0,e=a},m=function(a){var d=n(c,b);l(a),b.onChange&&b.onChange(a,d)},o=function(){return g?a.ui.renderers.MULTIPICKLIST.edit({value:e,entries:j,noneSelectedText:b.noneSelectedText,valueDelimiter:",",selectedList:4,onChange:function(a,b){m(a,b)}}):a.ui.renderers.PICKLIST.edit({value:e,entries:j,defaultValue:b.defaultValue,required:!0,onChange:function(a,b){m(a,b)}})};if(g&&i&&"node"===i.type){var p=c.children(h);e="",f=p.length,f&&i&&"node"===i.type&&(jb.each(p.children(i.name),function(){k.push(jb(this).text())}),e=k.join(","))}else e=c.attr(h),f=e&&"undefined"!=typeof e;return!g&&!f&&"defaultValue"in b&&l(b.defaultValue),d=o()},multipicklist:function(a,b,c){return Bc.picklist(a,b,c)},sobject:function(b,c){var d,e=b.id;return d=c.attr(e)?jb("<div>").addClass("nx-fieldtext").text(c.attr(e)||"").css("margin-top","6px"):a.ui.renderers.AUTOCOMPLETE.edit({source:a.utils.sObjectList,onChange:function(a,d){lb.getFields(d.item.value,function(){lb.updateState(c,{key:e,value:d.item.value}),b.onChange&&b.onChange(d.item.value)})}})},autocomplete:function(b,c){var d,e,f=jb("<div>").addClass("nx-field"),g=b.id,h=b.sobject,i=b.order,j=b.onChange,k=b.fieldsToSearch||["Name"],l=b.fieldsToReturn||["Name"],m=b.displayTemplate||"{{Name}}",n=b.valueTemplates||{},o={};return g in n||(n[g]="{{Name}}"),d=a.ui.renderers.AUTOCOMPLETE.edit({minLength:2,value:mb.decodeHTML(c.attr(g)),source:function(b,c,d,f){if(b.term in o)return void c(o[b.term]);e=b.term.split(" ");var g={fields:[{id:"Id"}],conditions:[],objectName:h,doQuery:!0};jb.each(l,function(a,b){"Id"!=b.toLowerCase()&&g.fields.push({id:b})}),i&&(g.order=i),jb.each(k,function(a,b){jb.each(e,function(a,c){g.conditions.push({field:b,operator:"LIKE",value:"%"+c+"%"})})});for(var j=[],m=1;m<=g.conditions.length;m++)j.push(""+m);g.conditionLogic=j.join("OR"),d(),a.RemotingStubs.load(JSON.stringify(g),function(a,d){f();var e=JSON.parse(a),g=e[0];d.status&&(o[b.term]=g.data,c(g.data))},{escape:!1})},onChange:function(b,d){var e={};return jb.each(n,function(b,f){var g=a.Mustache.render(f,d.item);e[b]=g,lb.updateState(c,{key:b,value:g})}),j&&j(e[g]),!1},onFocus:function(b,c){return d.val(a.Mustache.render(n[g],c.item)),!1},onClose:function(){d.focus()},onClear:function(){var a={};return jb.each(n,function(b){var d="";a[b]=d,lb.updateState(c,{key:b,value:d})}),j&&j(a[g]),!1},optionRenderer:function(b,c){var d="<a>"+a.Mustache.render(m,c)+"</a>";return jb.each(e,function(a,b){d=d.replace(b,"<b>"+b+"</b>")}),jb("<li></li>").data("ui-autocomplete-item",c).append(d).appendTo(b)},parentElem:f}),f.append(d),f},icon:function(a,b){var c,d,e=a.id,f=b.attr(e)||a.defaultValue||"",g=jb("<div>").addClass("nx-pagebuilder-property-button-area"),h=jb("<input>").attr("type","text").addClass("nx-picker-icon-input").val(f).appendTo(g),i=jb("<button>").addClass("nx-picker-icon-btn"),j=jb("<div>").appendTo(i);return""===f?j.removeClass().addClass("nx-picker-icon inline").text("?"):j.addClass("nx-picker-icon sk-icon inline "+f),i.on("click",function(){c?c.dialog("open"):(c=jb("<div>"),lb.buildIconPicker(c,h,j),c.dialog({width:800,height:400,title:"Choose an Icon",resizable:!0,modal:!0}))}),d=jb("<div>").addClass("nx-pagebuilder-property-button-wrapper").append(i),mb.delayInputCallback(h,function(c){""===c?j.removeClass().addClass("nx-picker-icon inline").text("?"):j.empty().removeClass().addClass("nx-picker-icon sk-icon inline "+c),lb.updateState(b,{key:e,value:c}),a.onChange&&a.onChange(c)}),[d,g]},numberbox:function(a,b){var c,d,e=n(b,a)||0,f=jb("<div>").addClass("sk-numberbox-wrapper"),g=[],h=a.boxes,i=function(a){jb.each(g,function(b){jb(this).toggleClass("sk-selected",a>b)})};for(d=0;h>d;d++)c=jb("<div>").addClass("sk-numberbox").css("width",100/h+"%"),g.push(c);return f.append(g),i(e),f.on("click",".sk-numberbox",function(){var c=jb(this).index()+1;o(b,{value:c,key:a.id}),i(c),a.onChange&&a.onChange(c)}),f},quicknumber:function(b,c){var d=n(c,b),e=jb("<div>").css({width:"80%",display:"inline-block"}),f=jb("<div>").css({width:"20%",display:"inline-block"}),g=function(a){var c=e.children();c.filter(".sk-selected").removeClass("sk-selected"),jb.each(c,function(c){a==b.options[c]&&jb(this).addClass("sk-selected")})},h=function(a){o(c,{value:a,key:b.id}),g(a),i.val()!=a&&i.val(a),b.onChange&&b.onChange(a)};b.options&&(jb.each(b.options,function(){var a=jb("<div>").addClass("sk-optionbutton").text(this);d==this&&a.addClass("sk-selected"),e.append(a)}),e.on("click",".sk-optionbutton",function(){h(b.options[jb(this).index()])}));var i=a.ui.renderers.TEXT.edit({value:n(c,b),onChange:h});return f.append(i),[e,f]}},Cc=function(a){var b,c,d,e,f,g=a.state,h=a.childNodeName,i=a.syntax,j=a.onChange,k=a.onClose;b=h?g.children(h).text()||"":g.text()||"",c=jb("<div>"),d=jb('<div id="skuidcodeditor">').addClass("nx-code-editor").appendTo(c).hide(),c.dialog({width:a.width||"80%",height:"auto",minHeight:600,title:a.title||"Edit Inline Code",resizable:!0,modal:!0,close:function(){var a=e.getValue();c.dialog("destroy"),c.remove(),k&&k(a)}}),e=window.ace.edit("skuidcodeditor"),i&&e.getSession().setMode("ace/mode/"+i),e.setValue(b),f=e.getSession().getUndoManager(),f.reset(),e.getSession().setUndoManager(f),e.getSession().getSelection().clearSelection(),d.show(),e.getSession().on("change",function(){var a=e.getValue(),b={value:a};h&&(b.childNodeName=h),o(g,b),j&&j(a)})},Dc=function(a,b){var c,d,e,f,g="",h="",i=a.length?a[0].id:!1,j=[];return b=b||{},jb.each(a,function(c){if(!this.rel)return!1;0!==c&&(h+=this.rel+".");var d=jb("<span>"+this.rel+(this.isPolymorphic&&this.ref!==this.rel?"("+this.ref+")":"")+"</span>").addClass("nx-pagebuilder-breadcrumb");this.isPolymorphic&&(g+=this.ref+"."),this.ref&&-1!==this.ref.indexOf(",")&&(this.possibleTargetObjects=this.ref.split(","),b.showObjectPickerIfPolymorphic?this.isPolymorphic=!0:this.ref="Name"),c<=a.length-2&&d.addClass("nx-pagebuilder-breadcrumb-link"),j.push(d)}),f=z(i),e=f&&"aggregate"==f.attr("type"),c=a[a.length-1].ref,d=a[a.length-1].rel,g.length>0&&-1!==g.indexOf(".")&&(g=g.substring(0,g.length-1)),{endsobject:c,endrel:d,isAggregate:e,targetObject:g,prefix:h,modelId:i,elements:j}},Ec=function(b){var c={},d=new Date,e="/resource/"+d.getTime()+"/",f=lb.pageXML.attr("theme");return f?jb.each(lb.availableThemes,function(a){a===f&&(e+=(this.skuid__Resource_Namespace__c?this.skuid__Resource_Namespace__c+"__":"")+this.skuid__Resource_Name__c)}):e+=a.page.runtimeThemeResource,e&&jb.getJSON(e+"/skuid_theme.json",function(a){b&&b(a)}),c},Fc=function(a){var b;return jb.each(i(),function(){return a[0]&&this.state&&this.state[0]&&this.state[0]===a[0]?(b=this,!1):void(b=!1)}),b},Gc=function(b){b=b||{};var c=b.isReference,d=b.sobject,e=b.propViewer,f='<searchfield query="true" return="true" show="true"/>';return{label:"Search Fields",linkedComponent:b.linkedComponent,id:"searchfields",isChild:!0,isNew:!0,deleteable:!1,propsFunction:function(a){var b=a.state,d=[{type:"helptext",html:"Use Search Fields to specify which fields to search on.  If you do not specify any fields, all searchable fields will be searched."}],f=b.parent().attr("searchmethod");return("server"===f||c)&&(d.push({type:"boolean",label:"Use SOSL to improve search performance",id:"usesosl",onChange:function(){a.state.attr("soslfields","Name Fields").empty(),a.save(),a.refresh(),a.rebuildProps&&a.rebuildProps(),a.renderProperties&&a.renderProperties(e)}}),"true"===b.attr("usesosl")&&d.push({id:"soslfields",type:"picklist",label:"Fields to Search",defaultValue:"Name Fields",picklistEntries:[{label:"Name Fields",value:"Name Fields"},{label:"All Text Fields",value:"All Fields"},{label:"Email Fields",value:"Email Fields"},{label:"Phone Fields",value:"Phone Fields"}],onChange:function(){a.refresh(),a.rebuildProps&&a.rebuildProps(),a.renderProperties&&a.renderProperties(e)}})),d},noItemsFunction:function(a){return jb("<div>").text(a.attr("usesosl")?"(Searching on "+a.attr("soslfields")+".)":c?"(Searching on name field.)":"(Searching on all searchable fields.)")},childrenFunction:function(g){return"true"===g.state.attr("usesosl")?[]:[{id:"searchfield",indent:1,linkedComponent:b.linkedComponent,addtooltip:"Add New Search Field",labelFunction:function(a){var e,f,g,h=a.attr("operator")||"contains",i=a.attr("field");
return!i||c&&"true"!==a.attr("query")||(g=s(b.modelName,i,d),g&&g.displaytype&&(e=mb.getSearchOperatorForDisplayType(h,g.displaytype,i),f=" "+e+" [Search]")),(a.attr("field")||"[No Field Selected]")+(f||"")},defaultStateFunction:function(){return nb(c?f:"<searchfield/>")},propsFunction:function(f){var g=f.state,h=g.attr("return"),i=g.attr("show"),j=g.attr("query"),k=g.attr("field"),l=k?s(b.modelName,k,d):!1,m=l?l.displaytype:!1,n=a.ui.searchableDisplayTypes,o=l?m in n:!1;"undefined"==typeof h&&(h="true"===i?"true":"false",g.attr("return",h),f.save());var p=[{id:"field",type:"field",label:"Field",displayTypeFilter:function(a){return c||a.displaytype in n},modelname:b.modelName,sobject:d,allowModelFieldAdds:!0,onChange:function(a){if(c){var h=s(b.modelName,a,d);if(h&&h.displaytype===Jb){var i,j=h.rel+"."+mb.getNameField(d),k=g.siblings('[field="'+mb.escapeSelector(j)+'"]'),l=g.parent();k.length||(l.append(nb('<searchfield query="true" return="true" show="false" field="'+j+'"/>')),i=Fc(l.parent()),i&&(i.save(),i.rebuildProps&&i.rebuildProps(),i.renderProperties&&i.renderProperties(e)))}}f.refresh().rebuildProps()}}];if(c&&o&&p.push({id:"query",type:"boolean",label:"Search this Field",onChange:function(){f.save(),f.refresh&&f.refresh(),f.rebuildProps&&f.rebuildProps(),f.renderProperties&&f.renderProperties(e)}}),k&&(!c||"true"===j)&&l&&o){var q,r=!1,t=jb.map(H("searchfield",m),function(a,b){return"contains"===b&&(r=!0),{label:a.name,value:b}});q=m===Fb?"includes":r?"contains":t[0].value,t.length&&p.push({id:"operator",type:"picklist",label:"Search Operator",defaultValue:q,picklistEntries:t,onChange:function(){f.refresh()}})}return c&&(p.push({id:"return",type:"boolean",readonly:"true"===i,label:"Return Field in query results",onChange:function(){f.save(),f.rebuildProps&&f.rebuildProps(),f.renderProperties&&f.renderProperties(e)}}),"true"===h&&p.push({id:"show",type:"boolean",label:"Show Field in Search Popup",onChange:function(){f.save(),f.rebuildProps&&f.rebuildProps(),f.renderProperties&&f.renderProperties(e)}}),"true"===i&&p.push({id:"label",type:"template",displayAs:"input",location:"node",label:"Custom Label"})),p}}]}}},Hc=function(b){b||(b={});var c=b.component,d=b.modelName,e=c.updateSearchBox?c.updateSearchBox:!1,f=[{id:"searchbox",type:"boolean",label:"Show Search Box",helptext:"By default, a search box is displayed, allowing for full-text search on all searchable fields displayed in this table. Uncheck this box to hide this search box.",onChange:function(){e&&e()}},{id:"tokenizesearch",type:"boolean",label:"Tokenize Search Terms",helptext:"If checked, this will split search terms on the 'space' character and search for them separately."},{id:"searchmethod",type:"picklist",label:"Search Method",defaultValue:"server",helptext:'By default, table search is performed server-side, meaning that all records in the database will be searched for the text in the search box. To search just the records initially retrieved in the model, select "Client" instead.',picklistEntries:[{label:"Server",value:"server"},{label:"Client",value:"client"}]},{id:"searchplaceholdertext",type:"template",displayAs:"input",location:"attribute",label:"Search box placeholder text",onChange:function(){e&&e()},helptext:'(Optional) Custom text to display as a placeholder in the search box until the user starts typing, e.g. "Search newly created Accounts...". Defaults to "Search " + the plural label of the Model\'s SObject, e.g. "Search Accounts"'},{id:"emptysearchbehavior",type:"picklist",label:"Empty Search Behavior",defaultValue:"query",helptext:'By default, when the search box is emptied, the Model is requeried, but with no search Condition applied, so records will likely be returned. To remove all records from this Model when the search box is emptied, select "Remove all Model data".',picklistEntries:[{label:"Re-query for Model data",value:"query"},{label:"Remove all Model data",value:"remove"}]}],g=[];return a.mobile||g.push({label:"Filter & Search Behavior",linkedComponent:c,deleteable:!1,props:[{id:"instantfilters",type:"boolean",label:"Apply Filters and Search Immediately",defaultValue:!0,helptext:'By default, changing a Filter or entering search text will immediately re-query this Component\'s Model. Disable this setting to instead shown "Apply" and "Cancel" buttons which delay execution of filters and search until the user clicks "Apply".'}]}),g.push({label:"Search Properties",linkedComponent:c,deleteable:!1,props:f},Gc({modelName:d,linkedComponent:c})),{name:"Filters & Search",tree:g}},Ic=function(){var a={},b={},c={};return jb.each(lb.availablePacks,function(){var d=this,e=d.components,f=d.folders;e&&e.length&&jb.each(e,function(){var c,e=d.id+"__"+this.id,f=e.split("__");"skuidcore"===f[0]||"skuidmobilecore"===f[0]?(f.shift(),c=f.join("__")):lb.getBuilder(e)?c=e:(f.shift(),c=f.join("__")),this.builder=lb.getBuilder(c),this.folderId?(this.folderId in a||(a[this.folderId]={}),a[this.folderId][e]=this):b[d.id+"__"+this.id]=this}),f&&f.length&&jb.each(f,function(){this.components=a[this.id],c[d.id+"__"+this.id]=this})}),{noFolderComponents:b,activeFolders:c}},Jc=function(a,b){if(!a||!b)return!1;var c=a.emitsComponentAspects,d=b.acceptsComponentAspects,e=b.rejectsComponentAspects,f=a.rejectByDefault?!1:!0;if(d&&d.length){if(!c||!c.length)return!1;f=!1,jb.each(d,function(a,b){return-1!==c.indexOf(b)?(f=!0,!1):void 0})}return f&&e&&e.length&&c&&c.length&&jb.each(e,function(a,b){return-1!==c.indexOf(b)?(f=!1,!1):void 0}),f};jb.extend(lb,{Builder:d,layoutFields:mb.layoutFields,getBuilder:l,getBuilders:m,registerBuilder:j,registerBuilders:k,registerComponent:g,unregisterComponent:h,getComponentsList:i,fieldsDescribeCache:sb,dropStack:tb,componentsNeedingRefresh:ub,getStoredValue:n,updateState:o,getFields:q,getFieldInfoFromCache:s,getConditionDisplayString:r,save:p,userinfomap:$b,operatormap:Zb,dateliteralmap:_b,getValidOperators:H,determineQuotedness:u,getMetadataForField:t,isValidFieldForPossibleTargetObjects:w,getConditionByName:B,getDefaultAliasName:c,getFirstModel:A,getModelFromModelName:z,getSObjectForField:v,getSObjectNameFromModelName:x,getUniqueModelName:b,isFieldInModel:D,addFieldToModel:E,buildIconPicker:X,showCodeEditor:Cc,conditionDescriptionRenderers:fc,getConditionFieldPropObj:G,getConditionOperatorPropObj:I,getConditionValueProperties:F,getConditionStateProperties:J,getContextCategory:Z,getRenderingCategory:$,getHotkeysCategory:V,getValueEditorFromMetadata:K,getCoreActionProperties:P,getCoreActionOptions:L,getValidActionOptions:N,addValidActionOptions:M,getActionTreeNode:T,getActionsCategory:U,getActionLabel:O,getFieldProperties:R,getModelProperties:Q,getLabelProperties:_,getJSItemLabel:ab,getCSSItemLabel:cb,getFilterItemLabel:eb,getEffectItemLabel:gb,getJSItemProperties:bb,getCSSItemProperties:db,getFilterItemProperties:fb,getEffectItemProperties:ib,getLastSelectedModelComponent:yc,setLastSelectedModelComponent:zc,propertyRenderers:Bc,processBreadCrumbInfo:Dc,publishStateEvent:xc,handleModelRemove:cc,handleModelIdChange:dc,getIconsObject:Ec,getComponentFromState:Fc,getSearchFieldsTreeItem:Gc,getListSearchPropsCategory:Hc,getAvailableComponentsWithFolders:Ic,doesParentAcceptComponent:Jc})}(skuid),function(a){var b={init:function(b){return this.each(function(){var c,d=a(this),e=b.axis,f=b.parentStateSelector,g=b.grandparentStateSelector,h=b.component,i=b.items,j=b.placeholder,k=b.connectWith,l=b.containment;i&&(c=i.substr(2)),h&&d.sortable({items:i?i:"> *",placeholder:j?j:!1,axis:e,opacity:.75,delay:200,handle:b.handle,tolerance:"pointer",revert:200,connectWith:k?k:!1,containment:l?l:!1,start:function(a,b){b.item.startingIndex="> *"==i?b.item.index():b.item.parent().children(c).index(b.item);var d=b.item.parent().closest(".nx-pagebuilder-component").parent().children(".nx-pagebuilder-component"),e=b.item.parent().closest(".nx-pagebuilder-component");b.item.parentStartingIndex=d.index(e)},stop:function(a,d){var e,j,k,l=d.item.startingIndex,m="> *"==i?d.item.index():d.item.parent().children(c).index(d.item),n=d.item.parentStartingIndex,o=d.item.parent().closest(".nx-pagebuilder-component").parent().children(".nx-pagebuilder-component"),p=d.item.parent().closest(".nx-pagebuilder-component"),q=o.index(p);if(n!=q){var r=h.state.find(g).eq(n).children(f).first(),s=h.state.find(g).eq(q).children(f).first();j=r.children().eq(l),j.detach(),k=s.children().length,k>m?j.insertBefore(s.children().eq(m)):m>=k&&j.appendTo(s)}else e=f?f&&g?h.state.find(g).eq(q).children(f).first():h.state.find(f).first():h.state,j=e.children().eq(l),j.detach(),k=e.children().length,k>m?j.insertBefore(e.children().eq(m)):m>=k&&j.appendTo(e);h.save(),b.onSort&&b.onSort(d.item)}})})}};a.fn.sortableComponent=function(c){return b[c]?b[c].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof c&&c?void a.error("Method "+c+" does not exist on the sortableComponent plugin"):b.init.apply(this,arguments)}}(skuid.$),function(a){var b=a.builder.mobile={},c=a.$,d=a.utils,e=d.makeXMLDoc,f=a.builder.core,g=a.mobile,h=a.events.subscribe,i=a.events.publish,j=a.componentType.register,k=a.componentType.get;f.addValidActionOptions([{value:"-",label:"Visual navigation",disabled:!0},{value:"setLeftPanel",label:"Set Left Panel"},{value:"toggleLeftPanel",label:"Toggle Left Panel"},{value:"hideLeftPanel",label:"Hide Left Panel"},{value:"setMainPanel",label:"Set Main Panel"},{value:"setPopupPanel",label:"Set Popup Panel"},{value:"hidePopupPanel",label:"Hide Popup Panel"},{value:"blockUI",label:"Show message and block UI"},{value:"unblockUI",label:"Unblock the UI"},{value:"redirect",label:"Go to URL"},{value:"toggleSetupMenu",label:"Toggle Setup Menu"}]),f.addValidActionOptions(f.getCoreActionOptions()),b.model,b.row,b.pageXML,b.mobileXML,b.resourcesXML,b.componentViewer,b.propertyViewer,b.makeAddComponentsCategory=function(a){return a=a||{},{label:a.label||"Add Components",props:[{type:"validcomponents",childrenNodeName:a.childrenNodeName}]}},b.makeDraggableComponent=function(a,d){a.draggable({handle:".smb-component-gripper",appendTo:g.panelarea,delay:100,helper:function(){var a=c("<div>").addClass("smb-component-draghelper");return a.append(c("<div>").text(d.name)),a},scroll:!0,revert:"invalid",start:function(){a.addClass("smb-component-dragging");var d=c(this).data("ui-draggable");d.scrollParent=b.componentViewer.element,d.overflowOffset=d.scrollParent.offset()},stop:function(){a.removeClass("smb-component-dragging")},scrollSensitivity:60,scrollSpeed:10,drag:function(a,b){var d=c(this).data("ui-draggable"),e=d,f=e.options,g=!1;b.position.top-=e.scrollParent[0].scrollTop,e.overflowOffset.top+e.scrollParent[0].offsetHeight-a.pageY<f.scrollSensitivity?e.scrollParent[0].scrollTop=g=e.scrollParent[0].scrollTop+f.scrollSpeed:a.pageY-e.overflowOffset.top<f.scrollSensitivity&&(e.scrollParent[0].scrollTop=g=e.scrollParent[0].scrollTop-f.scrollSpeed),g&&c.ui.ddmanager.prepareOffsets(d,a)},cursorAt:{right:10,top:10}})},b.FieldSelectDeck=function(b,d){var e=this;if(b||(b=c("<div>")),e.breadcrumb=d.breadcrumb,!e.breadcrumb)return!1;if(e.options=d,e.element=b,b.addClass("smb-fielddeck nx-list-contents sm-grid").data({layoutmode:"rigid",minwidth:"160",precision:"10"}),b.off(),b.on("tap",".smb-fieldcard",function(a){a.stopPropagation()}),b.on("hold",".smb-fieldcard",function(a){var b=c(this).closest(".smb-fieldcard").data("card");b.toggleSelect(),a.stopPropagation()}),b.on("tap",".smb-fieldcard-toggle",function(){var a=c(this).closest(".smb-fieldcard").data("card");a.toggleSelect()}),b.on("tap",".smb-fieldcard-referencelink",function(){var a=c(this).closest(".smb-fieldcard").data("card");e.followReference(a.fielddata)}),d.controls){e.subcontrolwrapper=c("<div>").addClass("smb-fielddeck-subcontrol"),e.breadcrumbwrapper=c("<div>").addClass("smb-breadcrumb-wrapper"),e.quickletterwrapper=c("<div>").addClass("smb-quickletter-wrapper");var f=c("<div>").addClass("smb-fielddeck-search-wrapper"),g=c("<div>").addClass("smb-fielddeck-selected-wrapper");if(d.showSelectedFilter){var h=c("<div>").addClass("smb-fielddeck-selected-toggle").text("S").on("tap",function(){e.selectedOnly=!e.selectedOnly,c(this).toggleClass("active"),e.render()});g.append(h)}else g.hide(),e.subcontrolwrapper.addClass("nofilter");e.searchBox=a.ui.renderers.TEXT.edit({onChange:function(a){e.searchtext=a,e.render()}}).css("padding","7px 6px 6px 6px"),f.append(e.searchBox),e.subcontrolwrapper.append(e.breadcrumbwrapper,e.quickletterwrapper),d.controls.append(f,g,e.subcontrolwrapper),e.breadcrumbwrapper.on("tap",".nx-pagebuilder-breadcrumb-link",function(){e.breadcrumb=e.breadcrumb.slice(0,c(this).index()+1),e.render()})}},b.FieldSelectDeck.prototype.render=function(){var a=this;a.element.empty();var d=f.processBreadCrumbInfo(a.breadcrumb);if(!d.endsobject)return a.element.append(c("<div>").addClass("smb-fielddeck-error").text("Select an SObject for this Model.")),!1;var e=a.options.controls;e&&(a.breadcrumbwrapper.empty(),a.breadcrumbwrapper.append(d.elements)),a.options.prefix=d.prefix,f.getFields(d.endsobject,function(f){c.each(f.fields,function(){if(a.searchtext){var c=-1!==this.id.toLowerCase().indexOf(a.searchtext.toLowerCase()),e=-1!==this.label.toLowerCase().indexOf(a.searchtext.toLowerCase());if(!c&&!e)return!0}return a.options.filter,a.options.filter&&!a.options.filter(this,d.prefix)?!0:a.selectedOnly&&a.options.isSelected&&!a.options.isSelected(this,d.prefix)?!0:void a.element.append(new b.FieldSelectCard(this,a.options).element)}),g.processResponsiveArea(a.element),e.find(":input").focus()})},b.FieldSelectDeck.prototype.followReference=function(a){var b={rel:a.rel,ref:a.ref,isPolymorphic:!1};this.searchBox.val(""),this.searchtext="",this.breadcrumb.push(b),this.render()},b.FieldSelectCard=function(a,b){this.fielddata=a,this.deckoptions=b,this.element=c("<div>").addClass("smb-fieldcard sm-card sm-grid-division").data("size","1"),this.element.data("card",this),this.body=c("<div>").addClass("smb-fieldcard-inner");var d=c("<div>").addClass("smb-fieldcard-title"),e=c("<div>").addClass("smb-fieldcard-body");this.fieldCardToggle=c("<div>").addClass("smb-fieldcard-toggle fa fa-fw");var f=c("<div>").addClass("smb-fieldcard-referencelink fa fa-fw fa-external-link");this.fieldReferenceCount=c("<div>").addClass("smb-fieldcard-referencecount"),this.body.append(d,e,this.fieldCardToggle);var g=a.displaytype;d.text(a.label),"REFERENCE"===a.displaytype&&"null"!==a.rel&&a.referenceTo&&a.referenceTo.length&&(this.body.append(f),this.deckoptions.referenceCount&&(this.updateReferenceCount(),this.body.append(this.fieldReferenceCount)),g="REF"),e.text(g),this.setSelect(),this.element.append(this.body)},b.FieldSelectCard.prototype.updateReferenceCount=function(){this.fieldReferenceCount.text(this.deckoptions.referenceCount(this.fielddata,this.deckoptions.prefix))},b.FieldSelectCard.prototype.isSelected=function(){return this.deckoptions.isSelected&&this.deckoptions.isSelected(this.fielddata,this.deckoptions.prefix)},b.FieldSelectCard.prototype.toggleSelect=function(){this.isSelected()?this.deckoptions.onUnselect&&this.deckoptions.onUnselect(this.fielddata,this.deckoptions.prefix,this):this.deckoptions.onSelect&&this.deckoptions.onSelect(this.fielddata,this.deckoptions.prefix,this),this.setSelect()},b.FieldSelectCard.prototype.setSelect=function(){this.isSelected()?(this.body.addClass("smb-fieldcard-inmodel"),this.fieldCardToggle.addClass("fa-times"),this.fieldCardToggle.removeClass("fa-check")):(this.body.removeClass("smb-fieldcard-inmodel"),this.fieldCardToggle.addClass("fa-check"),this.fieldCardToggle.removeClass("fa-times"))},b.propertyRenderers={standard:function(a,b){var d=c("<div>").addClass("sm-field-label").text(a.label);a.element.append(d,f.getValueEditorFromMetadata(a,b,a.id))},helptext:function(a){a.element.append(c("<div>").addClass("smb-proptertyitem-helparea").html(a.html))},field:function(a,d){var e,h,i,j=c("<div>").addClass("sm-field-label").text(a.label),k=f.getStoredValue(d,a),l=function(b){f.updateState(d,{value:b,key:a.id}),n.text(b),a.onChange&&a.onChange(b),g.hidePopupPanel()};a.sobject?e=a.sobject:(h=a.modelname?a.modelname:a.modelprop?d.attr(a.modelprop):d.closest("model").attr("id"),h&&(i=f.getModelFromModelName(h)),e=f.getSObjectNameFromModelName(h));var m=c("<div>"),n=c("<div>").addClass("smb-propertyitem-valuetextbox").text(k);d.attr(a.id)!==k&&l(k);var o=c("<div>").addClass("smb-propertyitem-actionbutton fa fa-fw fa-wrench").on("tap",function(){var f=c("<div>").addClass("smb-fielddeckcontrols").css({left:"122px","padding-top":"1px"}),h=new b.FieldSelectDeck(c("<div>"),{breadcrumb:[{rel:e,ref:e}],controls:f,isSelected:function(b,c){return c+b.id===d.attr(a.id)},onSelect:function(a,b){l(b+a.id)},onUnselect:function(){l("")},filter:a.filter});g.setPopupPanel(h.element,{title:function(a){a.append(c("<span>").text("Select a Field"),f)},noPadding:!0}),h.render()});m.append(o,n),a.element.append(j,m)},model:function(a,b){var d=c("<div>").addClass("sm-field-label").text(a.label);a.element.append(d,f.propertyRenderers.model(a,b))},models:function(a,b){var d=c("<div>").addClass("sm-field-label").text(a.label);a.element.append(d,f.propertyRenderers.models(a,b))},condition:function(a,b){var d=c("<div>").addClass("sm-field-label").text(a.label);a.element.append(d,f.propertyRenderers.condition(a,b))},panel:function(d,e){var g,h=c("<div>").addClass("sm-field-label").text(d.label),i=d.id,j=[];b.panelsXML.children().each(function(){var a=c(this).attr("uniqueid");j.push({value:a,label:a})}),g=a.ui.renderers.PICKLIST.edit({value:e.attr(i),entries:j,onChange:function(a){f.updateState(e,{key:i,value:a}),d.onChange&&d.onChange(a)}}),d.element.append(h,g)},"boolean":function(a,b){var d=c("<div>").addClass("sm-field-label").text(a.label);a.element.append(d,f.propertyRenderers["boolean"](a,b))},multiitem:function(a,b){var d=a.id,g=a.storeAs,h=c("<div>").addClass("sm-field-label").text(a.label),i=b.children(d),j=c("<div>"),k=function(e){var g=c("<div>").addClass("smb-propertyitem-multiitem").css("clear","both"),h=c("<div>").addClass("smb-propertyitem-valuebox"),i=c("<div>").addClass("smb-propertyitem-actionbutton smb-propertyitem-actionbutton-black fa fa-fw fa-times").on("tap",function(b){e.remove(),g.remove(),a.onChange&&a.onChange(),b.gesture.preventDefault()});return h.append(f.getValueEditorFromMetadata(a,b,d,e)),g.append(i,h)};i.length||(i=e("<values/>").append(e("<value/>")),i.appendTo(b)),i.children(g.name).each(function(){j.append(k(c(this)))}),a.element.append(h,j),a.element.append(c("<div>").text("Add Another Value").addClass("smb-property-action").css("margin-left","0px").on("tap",function(b){var c=e("<value/>").appendTo(i);j.append(k(c)),a.onChange&&a.onChange(),b.gesture.preventDefault()}))},sobject:function(a,b){var d=c("<div>").addClass("sm-field-label").text(a.label);a.element.append(d,f.propertyRenderers.sobject(a,b))},numberbox:function(a,b){var d=c("<div>").addClass("sm-field-label").text(a.label);a.element.append(d,f.propertyRenderers.numberbox(a,b))},quicknumber:function(a,b){var d=c("<div>").addClass("sm-field-label").text(a.label);a.element.append(d,f.propertyRenderers.quicknumber(a,b))},picklist:function(a,b){var d=c("<div>").addClass("sm-field-label").text(a.label);a.element.append(d,f.propertyRenderers.picklist(a,b))},multipicklist:function(a,b){var d=c("<div>").addClass("sm-field-label").text(a.label);a.element.append(d,f.propertyRenderers.multipicklist(a,b))},icon:function(a,b){var d=c("<div>").addClass("sm-field-label").text(a.label);a.element.append(d,f.propertyRenderers.icon(a,b))},autocomplete:function(a,b){var d=c("<div>").addClass("sm-field-label").text(a.label);a.element.append(d,f.propertyRenderers.autocomplete(a,b))},validcomponents:function(a,d){var h=d[0].nodeName.toLowerCase(),j=f.getBuilder(h),k=f.getAvailableComponentsWithFolders(),l=k.noFolderComponents,m=k.activeFolders;if(a.element.css("margin-top","0px"),!l)return!1;var n=function(a,d){if(d&&d.options&&d.options.makeDraggable===!1)return!0;if(!f.doesParentAcceptComponent(d,j))return!0;var e=c("<div>").addClass("smb-component-tag-wrapper"),g=c("<div>").addClass("smb-component-tag").text(d.name),h=c("<div>").addClass("smb-component-titlebuttons"),i=c("<div>").addClass("smb-component-titlebutton smb-component-gripper fa fa-bars fa-fw");h.append(i),g.append(h),g.data("builder",d),b.makeDraggableComponent(g,d),e.append(g),a.append(e)};c.each(l,function(){return n(a.element,this.builder)}),c.each(m,function(){var b=this,d=c("<div>").addClass("smb-folder"),e=c("<div>").addClass("smb-folder-header").text(b.name),f=c("<div>").addClass("smb-folder-body");c.each(b.components,function(){return n(f,this.builder)}),f.children().length&&(d.append(e,f),a.element.append(d))}),a.element.on("doubletap",".smb-component-tag",function(h){var j=c(this).data("builder"),k=new b.Component(j.defaultStateGenerator()).render(),l=f.getComponentFromState(d);l.body.append(k.element),k.builder&&k.builder.afterAttach&&k.builder.afterAttach(k);var m=a.childrenNodeName||"components",n=d.children(m).first();n.length||(n=e("<"+m+"/>").appendTo(d)),n.append(k.state),i("skuidBuilderSave"),h.gesture.preventDefault(),h.stopPropagation(),g.processResponsiveArea(l.element)})},remove:function(a,b){var d=b[0].nodeName.toLowerCase(),e=f.getBuilder(d),g=c("<div>").addClass("smb-property-action").text("Remove this "+(e?e.name:"Component")).click(function(){var c=f.getComponentFromState(b);c.remove(),a.onChange&&a.onChange()});a.element.append(g)},customaction:function(a){var b=c("<div>").addClass("smb-property-action").text(a.label||"Custom Action");a.customAction&&b.on("tap",function(){a.customAction()}),a.element.append(b)},template:function(a,b){var e="node",g="attribute";a.location||(a.location=e);var h=f.getStoredValue(b,a);if(!h&&a.defaultValue){h=a.defaultValue;var i={value:h};a.location==e&&a.id?i.childNodeName=a.id:a.location==g&&(i.key=a.id),f.updateState(b,i)}var j=a.displayAs,k=c("<"+("input"===j?"input":"textarea")+">").val(h);d.delayInputCallback(k,function(c){var d={value:c};a.location==e&&a.id?d.childNodeName=a.id:a.location==g&&(d.key=a.id),f.updateState(b,d),a.onChange&&a.onChange(c)});var l=c("<div>").addClass("sm-field-label").text(a.label);a.element.append(l,k)},code:function(a,b){c("<div>").addClass("sm-field-label").text(a.label).appendTo(a.element);var d=c("<div>").css("position","relative").css("height","400px").appendTo(a.element),e=c("<div>").addClass("nx-code-editor").appendTo(d).hide(),g=window.ace.edit(e[0]);a.syntax&&g.getSession().setMode("ace/mode/"+a.syntax),g.setValue(f.getStoredValue(b,a));var h=g.getSession().getUndoManager();h.reset(),g.getSession().setUndoManager(h),g.getSession().getSelection().clearSelection(),e.show(),g.getSession().on("change",function(){var c=g.getValue(),d={value:c};a.id&&(d.childNodeName=a.id),f.updateState(b,d),a.onChange&&a.onChange(c)})}},b.Component=function(a,d){if(!a||!a[0])return!1;var e=this;return d?(e.builder=d,e.builderId=e.builder.id):(e.builderId=a[0].nodeName.toLowerCase(),e.builder=f.getBuilder(e.builderId)),e.builder?(f.registerComponent(e),e.builderoptions=c.extend({allowSelection:!0,makeDraggable:!0,makeSiblingDropZone:!0},e.builder.options),e.element=c("<div>").addClass("smb-component"),e.header=c("<div>").addClass("smb-component-header"),e.headerTitle=c("<div>").addClass("smb-component-header-title").text(e.builder?e.builder.name:e.builderId),e.titleButtons=c("<div>").addClass("smb-component-titlebuttons"),e.gripper=c("<div>").addClass("smb-component-titlebutton smb-component-gripper fa fa-ellipsis-v fa-fw"),e.header.append(e.headerTitle,e.titleButtons),e.builderoptions.makeDraggable&&e.titleButtons.append(e.gripper),e.body=c("<div>").addClass("smb-component-body"),e.element.append(e.header,e.body),e.builderoptions.makeSiblingDropZone&&(e.dropzone=new b.DropZone,e.element.append(e.dropzone.element)),e.state=a,void e.element.data("component",e)):!1},b.Component.prototype.setTitle=function(a){return this.headerTitle.text(a),this},b.Component.prototype.setHeaderText=function(a){return this.setTitle(a)},b.Component.prototype.render=function(){return this.builder&&(this.builder.mobileRenderer?this.builder.mobileRenderer(this):this.builder.componentRenderer&&this.builder.componentRenderer(this)),this},b.Component.prototype.refresh=function(){return this.body.children().detach(),this.render(),this.builder&&this.builder.afterAttach&&this.builder.afterAttach(this),this},b.Component.prototype.renderProperties=function(a){var b=this;return a&&a.clear(),b.builder&&b.builder.propertiesRenderer(a,b),b},b.Component.prototype.renderChildren=function(a,b){this.addComponents(a,b||this.body)},b.Component.prototype.addComponents=function(a,d){a||(a="components");var g,h,i=this.state.children(a).first();i.length||(i=e("<"+a+"/>").appendTo(this.state)),g=i.children(),h=new b.ComponentAcceptor(d,i),g.each(function(){var a=c(this),e=f.getComponentFromState(a)||new b.Component(c(this)).render();d.append(e.element),e.builder&&e.builder.afterAttach&&e.builder.afterAttach(e)})},b.Component.prototype.select=function(a){this.builderoptions.allowSelection&&(a=c.extend({showPropertiesPanel:!0},a),b.componentViewer.addSelection(this),this.builderoptions.makeDraggable&&b.makeDraggableComponent(this.element,this.builder),i("skuidBuilderViewProperties",[this]),a.showPropertiesPanel&&g.addLeftPanel("propertyviewer",{transition:"slide",replace:!0,position:1}),i("skuidBuilderComponentSelect",[this]))},b.Component.prototype.unselect=function(){this.element.removeClass("smb-selected"),this.builderoptions.makeDraggable&&this.element.data("ui-draggable")&&this.element.draggable("destroy")},b.Component.prototype.remove=function(){b.componentViewer.clearSelection(),b.propertyViewer.clear(),this.element.remove(),this.state.remove(),this.save(),f.unregisterComponent(this),g.processResponsiveElements()},b.Component.prototype.save=function(){return i("skuidBuilderSave"),this},b.ComponentAcceptor=function(a,c){this.element=a.addClass("smb-acceptor"),this.element.data("acceptor",this),this.state=c,this.dropzone=new b.DropZone("acceptor"),this.element.append(this.dropzone.element)},b.DropZone=function(d){var e=this;this.type=d||"component",this.element=c("<div>").addClass("smb-dropzone"),this.element.droppable({accept:function(a){var b=a.data("component"),c=b?b.builder:a.data("builder");if(!c)return!1;var d=e.element.closest(".smb-acceptor").data("acceptor");if(!d)return!1;var g=d.element.closest(".smb-component").data("component").builder;return f.doesParentAcceptComponent(c,g)},tolerance:"touch",drop:function(d,h){if(f.dropStack=c(),e.element.is(".smb-dropzone-hover")){var j=h.draggable.data("component");if(j)j.state.detach(),j.element.detach();else{var k=h.draggable.data("builder");j=new b.Component(k.defaultStateGenerator()).render()}var l,m,n=e.element.closest(".smb-acceptor").data("acceptor").state;"acceptor"===e.type?(l=0,m=e.element):(l=e.element.parent().index(),m=e.element.parent()),m.after(j.element),a.utils.insertAtIndex(n,j.state,l),j.builder&&j.builder.afterAttach&&j.builder.afterAttach(j),i("skuidBuilderSave"),e.element.removeClass("smb-dropzone-hover"),g.processResponsiveElements()}},over:function(){f.dropStack=f.dropStack.add(c(this)),f.dropStack.removeClass("smb-dropzone-hover"),f.dropStack.first().addClass("smb-dropzone-hover")},out:function(){f.dropStack.removeClass("smb-dropzone-hover"),f.dropStack=f.dropStack.not(c(this)),f.dropStack.first().addClass("smb-dropzone-hover")},activeClass:"smb-dropzone-active"})},b.ComponentViewer=function(a){this.element=a.addClass("smb-component-viewer"),this.selectedComponent,a.on("tap",".smb-component",function(a){c(this).data("component").select(),a.gesture.preventDefault(),a.stopPropagation()}),a.on("hold",".smb-component",function(a){c(this).data("component").select({showPropertiesPanel:!1}),a.stopPropagation(),a.preventDefault()})},b.ComponentViewer.prototype.loadComponent=function(a){this.element.children().detach();var c=f.getComponentFromState(a);return c||(c=new b.Component(a).render()),this.element.append(c.element),this.clearSelection(),c},b.ComponentViewer.prototype.addSelection=function(a){this.clearSelection(),this.selectedComponent=a,a.element.addClass("smb-selected")},b.ComponentViewer.prototype.clearSelection=function(){this.selectedComponent&&this.selectedComponent.unselect(),this.selectedComponent=null},b.ComponentViewer.prototype.clear=function(){this.element.empty(),this.clearSelection()},b.PropertyViewer=function(a){var b=this;b.lists=[],b.element=a.addClass("smb-propview"),b.header=c("<div>").addClass("smb-propview-header sm-title"),b.headerText=c("<div>").addClass("smb-propviewer-headertext"),b.titleButtons=c("<div>").addClass("sm-titlebutton-wrapper"),b.closeButton=c("<div>").addClass("sm-titlebutton fa fa-angle-double-left fa-fw"),b.closeButton.click(function(){g.toggleLeftPanel("propertyviewer",{transition:"slide"})}),b.titleButtons.append(b.closeButton),b.header.append(b.titleButtons,b.headerText),b.body=c("<div>").addClass("smb-propview-body"),b.body.on("click",".smb-propertylist-header",function(){var a=c(this).parent().data("list");a&&a.revealContents&&a.revealContents()}),b.openLists={},b.element.append(b.header,b.body)},b.PropertyViewer.prototype.setTitle=function(a){this.headerText.text(a)},b.PropertyViewer.prototype.setHeaderText=function(a){this.setTitle(a)},b.PropertyViewer.prototype.loadComponent=function(a){this.openLists={},this.clear(),a.renderProperties(this)},b.PropertyViewer.prototype.addList=function(a){a.viewer=this,this.lists.push(a)},b.PropertyViewer.prototype.addLists=function(a){var b=this;c.each(a,function(){this.viewer=b,b.lists.push(this)})},b.PropertyViewer.prototype.render=function(){var a=this;this.body.empty(),c.each(this.lists,function(){this.render(this.state),a.body.append(this.element)})},b.PropertyViewer.prototype.clear=function(){this.body.empty(),this.lists=[],this.setTitle("")},b.PropertyViewer.prototype.applyPropTreeItem=function(a,c){if(a.isChild){var d=a.id;d||(d=a.childrenNodeName);var f=c.children(d);f.length||(f=a.defaultStateFunction&&a.defaultStateFunction()||e("<"+d+"/>"),c.append(f)),this.addList(new b.MiniComponentList(f,a))}else this.addList(new b.MiniComponentList(c,a))},b.PropertyViewer.prototype.applyPropTree=function(a,b){var d=this;a instanceof Array?c.each(a,function(a){d.applyPropTreeItem(this,b,{autoselect:0===a,wrapper:d.body})}):d.applyPropTreeItem(a,b,{autoselect:!0,wrapper:d.body})},b.PropertyViewer.prototype.applyPropsWithCategories=function(a,d){var e=this;c.each(a,function(){var a=this,c=a.state?a.state:d;(a.props&&a.props.length>0||a.customPropFunction||a.tree)&&(a.customPropFunction||(a.tree?e.applyPropTree(a.tree,c):e.addList(new b.PropertyList(c,a))))}),this.render()},b.MiniComponentList=function(a,d){d=d||{};var e=this;this.element=c("<div>").addClass("smb-propertylist"),this.element.data("list",this),this.header=c("<div>").addClass("smb-propertylist-header"),this.body=c("<div>").addClass("smb-propertylist-body").hide(),this.bodycontents=c("<div>"),this.propcontents=c("<div>"),this.expandIndicator=c("<div>").addClass("smb-propertylist-titleicon fa fa-chevron-down fa-fw"),this.items=[],this.inactive=d.inactive,this.state=d.state?d.state:a,this.childNodeCount=0,this.options=d,this.inactive&&this.element.hide(),this.fakeComponent={state:e.state,save:b.Component.prototype.save,rebuildProps:function(){e.getItems(),e.renderItems()},refresh:function(){}},this.childrenNodeName=d.childrenNodeName,this.childNodeName=d.childNodeName,this.childrenNodeName&&this.childNodeName&&(this.childbuilder=f.getBuilder(this.childNodeName),this.body.append(this.createAddButton(this.childbuilder,this.childrenNodeName))),this.body.append(this.propcontents,this.bodycontents),this.headertitle=c("<div>").addClass("smb-propertylist-headertitle").text(d.title||d.label),this.header.append(this.expandIndicator,this.headertitle),(this.childrenNodeName||this.childNodeName||this.options.childrenFunction||this.options.children)&&(this.headercount=c("<div>").addClass("smb-propertylist-headercount"),this.header.append(this.headercount)),this.element.append(this.header,this.body),this.getItems()
},b.MiniComponentList.prototype.createAddButton=function(a,b,d){var e=this;return c("<div>").addClass("smb-property-action").text(d||"Add new "+a.name).click(function(){e.addChild(a,b)})},b.MiniComponentList.prototype.addItem=function(a){this.items.push(a)},b.MiniComponentList.prototype.addItems=function(a){var b=this;c.each(a,function(){b.push(this)})},b.MiniComponentList.prototype.getItems=function(){var a=this;a.items=[];var d=this.options,e=d.propsFunction&&d.propsFunction(a.fakeComponent)||d.props||[];e&&c.each(e,function(c,d){a.addItem(new b.PropertyItem(d))})},b.MiniComponentList.prototype.renderItems=function(){var a=this;a.propcontents.empty(),c.each(this.items,function(){this.render(a.state),a.propcontents.append(this.element)})},b.MiniComponentList.prototype.createBuilderFromTreeObj=function(a){var d=a.linkedComponent;return new f.Builder({id:a.id,name:a.id,options:{makeSiblingDropZone:!1,makeDraggable:!1},mobileRenderer:function(b){b.bodycontent.text(a.labelFunction&&a.labelFunction(b.state)||a.label)},propertiesRenderer:function(d,e){var f=a.propsFunction&&a.propsFunction(e)||a.props||[],g=new b.PropertyList(e.state);c.each(f,function(){g.addItem(new b.PropertyItem(this))}),d.addLists([g]);var h=a.childrenFunction&&a.childrenFunction({state:e.state})||a.children;h&&c.each(h,function(){var a=this;d.addList(new b.MiniComponentList(e.state,{title:a.invisibleParentLabel||"Child Components",childrenFunction:function(){return[a]}}))}),d.render()},hideWrapper:!0,defaultStateGenerator:function(){return a.defaultStateFunction&&a.defaultStateFunction()||e("<"+a.id+"/>")},onSelect:function(){d&&d.element.addClass("nx-pagebuilder-selected")},resetPropCategory:!1})},b.MiniComponentList.prototype.render=function(){var a=this;if(a.bodycontents.empty(),this.childbuilder&&this.childrenNodeName){if(this.inactive)return!1;var d=this.state.children(this.childrenNodeName).first().children();d.each(function(){var d=new b.MiniComponent(c(this),a.childbuilder);d.render(),a.bodycontents.append(d.element)}),this.setCount(d.length)}else{this.renderItems();var e=this.options.childrenFunction&&this.options.childrenFunction({state:a.state})||this.options.children,f=0;e&&e.length&&c.each(e,function(){var d=this,e=!1,g=a.createBuilderFromTreeObj(d);a.bodycontents.append(a.createAddButton(g,d.invisibleParent,d.addtooltip));var h=c("<div>");a.bodycontents.append(h),h.sortableComponent({axis:"y",component:a.fakeComponent,parentStateSelector:d.invisibleParent,placeholder:"sk-placeholder",onSort:function(){a.render()},handle:".smb-minicomponent-handle"}),d.invisibleParent?a.state.children(d.invisibleParent).each(function(){c(this).children(d.id).each(function(){var a=new b.MiniComponent(c(this),g);a.render(),h.append(a.element),e=!0,f++})}):a.state.children(d.id).each(function(){var a=new b.MiniComponent(c(this),g);a.render(),h.append(a.element),e=!0,f++})}),this.setCount(f)}},b.MiniComponentList.prototype.addChild=function(a,c){var d=new b.MiniComponent(a.defaultStateGenerator(),a);if(c){var f=this.state.children(c).first();f.length||(f=e("<"+c+"/>").appendTo(this.state)),this.state.children(c).first().append(d.state)}else this.state.append(d.state);this.bodycontents.append(d.element),d.render(),this.increaseCount(),i("skuidBuilderSave")},b.MiniComponentList.prototype.revealContents=function(){this.body.slideToggle()},b.MiniComponentList.prototype.decreaseCount=function(){this.setCount(this.childNodeCount-1)},b.MiniComponentList.prototype.increaseCount=function(){this.setCount(this.childNodeCount+1)},b.MiniComponentList.prototype.setCount=function(a){this.childNodeCount=a,this.headercount&&this.headercount.text(this.childNodeCount)},b.MiniComponent=function(a,d){var e=this;this.builderId=d.id,this.builder=d,this.state=a,this.element=c("<div>").addClass("smb-minicomponent"),this.handle=c("<div>").addClass("smb-minicomponent-handle fa fa-ellipsis-v"),this.body=c("<div>").addClass("smb-minicomponent-body"),this.bodycontent=c("<div>").addClass("smb-minicomponent-content"),this.properties=new b.MiniPropViewer;var g=c("<div>").addClass("smb-minicomponent-removeicon fa fa-times fa-fw").click(function(a){e.remove(),a.stopPropagation()});f.registerComponent(e),this.body.append(g,this.bodycontent),this.element.append(this.handle,this.body,this.properties.element),this.body.on("click",function(){e.properties.element.slideToggle()})},b.MiniComponent.prototype.refresh=function(){return this.bodycontent.empty(),this.builder.mobileRenderer(this),this},b.MiniComponent.prototype.render=function(){this.builder&&(this.builder.mobileRenderer(this),this.builder.propertiesRenderer(this.properties,this))},b.MiniComponent.prototype.renderProperties=function(){return this.properties.clear(),this.builder.propertiesRenderer(this.properties,this),this},b.MiniComponent.prototype.rebuildProps=function(){return this.renderProperties()},b.MiniComponent.prototype.remove=function(){this.element.closest(".smb-propertylist").data("list").decreaseCount(),this.element.remove(),this.state.remove(),f.unregisterComponent(this),i("skuidBuilderSave")},b.MiniComponent.prototype.save=function(){return i("skuidBuilderSave"),this},b.MiniPropViewer=function(){this.lists=[],this.element=c("<div>").addClass("smb-minicomponent-propviewer").hide()},b.MiniPropViewer.prototype.clear=function(){this.lists=[],this.element.empty()},b.MiniPropViewer.prototype.addList=function(a){this.lists.push(a)},b.MiniPropViewer.prototype.addLists=function(a){var b=this;c.each(a,function(){b.lists.push(this)})},b.MiniPropViewer.prototype.render=function(){var a=this;this.element.empty(),c.each(this.lists,function(){this.render(this.state),a.element.append(this.element)})},b.MiniPropViewer.prototype.applyPropTreeItem=b.PropertyViewer.prototype.applyPropTreeItem,b.MiniPropViewer.prototype.applyPropTree=b.PropertyViewer.prototype.applyPropTree,b.MiniPropViewer.prototype.applyPropsWithCategories=b.PropertyViewer.prototype.applyPropsWithCategories,b.PropertyList=function(a,d){var e=this;d=c.extend({expanded:!1,title:""},d),e.items=[],e.element=c("<div>").addClass("smb-propertylist"),e.element.data("list",e),e.header=c("<div>").addClass("smb-propertylist-header"),e.body=c("<div>").addClass("smb-propertylist-body"),e.expanded=d.expanded,e.viewer=null,e.name=d.title||d.name||d.label,e.element.append(e.header,e.body),e.state=a;var f=d.propsFunction&&d.propsFunction({state:e.state,save:b.Component.prototype.save})||d.props||[];f&&c.each(f,function(a,c){e.addItem(new b.PropertyItem(c))})},b.PropertyList.prototype.addItem=function(a){this.items.push(a)},b.PropertyList.prototype.addItems=function(a){var b=this;c.each(a,function(){b.push(this)})},b.PropertyList.prototype.render=function(){var a=this,b=!1;this.body.empty(),this.name?(b=this.viewer&&this.viewer.openLists&&this.name in this.viewer.openLists?!!this.viewer.openLists[this.name]:this.expanded,this.headertitle=c("<div>").addClass("smb-propertylist-headertitle").text(this.name),this.expandIndicator=c("<div>").addClass("smb-propertylist-titleicon fa fa-chevron-"+(b?"up":"down")+" fa-fw"),this.header.append(this.expandIndicator,this.headertitle)):b=!0,this.expanded=b,this.body.toggle(this.expanded),c.each(this.items,function(){this.render(a.state),a.body.append(this.element)})},b.PropertyList.prototype.revealContents=function(){this.expanded=!this.expanded,this.expandIndicator.removeClass("fa-chevron-"+(this.expanded?"down":"up")),this.expandIndicator.addClass("fa-chevron-"+(this.expanded?"up":"down")),this.body.slideToggle(),this.viewer&&(this.viewer.openLists[this.name]=this.expanded)},b.PropertyItem=function(a){this.element=c("<div>").addClass("smb-propertyitem"),c.extend(this,a)},b.PropertyItem.prototype.render=function(a){this.element.empty();var c=this.type||"standard";b.propertyRenderers[c]?b.propertyRenderers[c](this,a):b.propertyRenderers.standard(this,a)},b.setupPageXML=function(a){if(a||(a=b.model.getFieldValues(b.row,f.layoutFields,!0).join("")),a.length){b.pageXML=e(a);var c=b.pageXML.children("components").first();b.mobileXML=c.children("skuidmobile").first(),b.mobileXML.length||(b.mobileXML=e("<skuidmobile><mobilepanels/><mobilenavs/></skuidmobile>").appendTo(c)),b.modelsXML=b.pageXML.children("models").first(),b.resourcesXML=b.pageXML.children("resources").first(),b.panelsXML=b.mobileXML.children("mobilepanels").first(),b.navsXML=b.mobileXML.children("mobilenavs").first()}f.pageXML=b.pageXML},j("mobileComponentViewer",function(d){b.model=a.model.getModel("page"),b.row=b.model.getFirstRow(),b.setupPageXML();var e=new b.ComponentViewer(d),j=function(){g.setLeftPanel("quicknav",{displaymode:"fit",preventProcessing:!0}),g.addLeftPanel("panels",{displaymode:"push",position:1}),c(".sm-buttonset-nav").removeClass("sm-active"),c("#quicknav").children().eq(2).addClass("sm-active")};h("skuidBuilderSave",function(){f.save(b.pageXML[0],b.model,b.row)}),b.componentViewer=e,h("skuidMobileReady",function(){j()}),h("skuidMobileSavePage",function(b){b&&b.button&&b.button.startProcessing(),a.model.getModel("page").save({callback:function(){b&&b.button&&b.button.stopProcessing()}})}),h("skuidMobileCancelPage",function(){a.model.getModel("page").cancel(),a.builder.mobile.setupPageXML(),b.propertyViewer.clear(),b.componentViewer.clear(),i("skuidBuilderRefreshModelList"),i("skuidBuilderRefreshNavList"),i("skuidBuilderRefreshPanelList"),i("skuidBuilderRefreshLabelList"),i("skuidBuilderRefreshJSItemList"),i("skuidBuilderRefreshCSSItemList"),j()}),h("skuidMobilePreviewPage",function(){var b=a.model.getModel("page"),c=a.snippet.getSnippet("skuid.builder.page.preview");c&&c({model:b})})}),j("mobilePropertyViewer",function(a){var c=new b.PropertyViewer(a);h("skuidBuilderViewProperties",function(a){c.loadComponent(a)}),b.propertyViewer=c}),j("mobileBuilderPageProperty_Theme",function(a){var d=c.map(f.availableThemes,function(a){return{label:a.Name,value:a.Name}});d.unshift({label:"Default",value:""});var e={id:"theme",type:"picklist",label:"Theme",picklistEntries:d,helptext:"The name of the theme to use."},g=new b.PropertyItem(e);g.render(b.pageXML),a.append(g.element)}),j("mobileBuilderPageProperty_UnsavedChangesWarning",function(a){var c={id:"unsavedchangeswarning",type:"picklist",label:"Warn users if page has unsaved changes",picklistEntries:[{label:"No",value:""},{label:"Yes",value:"yes"}],defaultValue:"",helptext:"If a user tries to leave or close this page, and one or more of its Models has unsaved changes, a warning message will be shown before they can leave."},d=new b.PropertyItem(c);d.render(b.pageXML),a.append(d.element)}),j("mobileBuilderModelList",function(a){a.append(k("mobileBuilderPropertyPanelHeader")({title:"Models",showCloseButton:!0,closePanel:"models",showAddButton:!0,eventToPublishOnAdd:"skuidBuilderAddModel"}),k("mobileBuilderPropertyPanelList")({xmlParentFunction:function(){return b.modelsXML},addEventName:"skuidBuilderAddModel",builderName:"model",refreshEventName:"skuidBuilderRefreshModelList",labelFunction:function(a){return a.attr("id")},showRemoveButton:!1}))}),j("mobileBuilderNavList",function(a){a.append(k("mobileBuilderPropertyPanelHeader")({title:"Headers and Footers",showCloseButton:!0,closePanel:"navs",showAddButton:!0,eventToPublishOnAdd:"skuidBuilderAddNav"}),k("mobileBuilderPropertyPanelList")({xmlParentFunction:function(){return b.navsXML},addEventName:"skuidBuilderAddNav",builderName:"mobilenav",refreshEventName:"skuidBuilderRefreshNavList",labelFunction:function(a){var b="footer"===a.attr("type")?"Footer":"Header",c=a.attr("name")||b;return c+=a.attr("uniqueid")?" - "+a.attr("uniqueid"):" - [New "+b+"]"},showRemoveButton:!1}))}),j("mobileBuilderPanelList",function(a){a.append(k("mobileBuilderPropertyPanelHeader")({title:"Page Panels",showCloseButton:!0,closePanel:"panels",showAddButton:!0,eventToPublishOnAdd:"skuidBuilderAddPanel"}),k("mobileBuilderPropertyPanelList")({xmlParentFunction:function(){return b.panelsXML},addEventName:"skuidBuilderAddPanel",builderName:"mobilepanel",refreshEventName:"skuidBuilderRefreshPanelList",labelFunction:function(a){return a.attr("uniqueid")||"[New Panel]"},showRemoveButton:!1}))}),j("mobileBuilderPropertyPanelList",function(a){var d=a.element||c("<div>");d.on("tap",".sm-button-custom",function(){var d=a.xmlParentFunction&&a.xmlParentFunction(),e=c(this).index();b.componentViewer.loadComponent(d.children().eq(e)),g.processResponsiveElements()});var e=function(){var f=a.xmlParentFunction&&a.xmlParentFunction(),h={state:f,save:b.Component.prototype.save,rebuildProps:function(){e()}};d.empty(),d.sortableComponent({axis:"y",component:h,placeholder:"sk-placeholder",onSort:function(){e()},handle:".smb-minicomponent-handle"}),f.children().each(function(){var e,f,h=c(this),i=new g.ui.Button({icon:a.icon,iconColor:"#bbb",label:a.labelFunction(h)});i.element.css("position","relative").addClass("smb-menupropertylist sm-button-custom sm-liststyle sm-level"+(a.indentLevel||0)),a.showRemoveButton&&(e=c("<div>").addClass("sm-titlebutton sm-accordion-item-button fa fa-times fa-fw").on("tap",function(a){new b.Component(h).remove(),b.componentViewer.clear(),i.element.remove(),a.stopPropagation()}),f=c("<div>").addClass("sm-titlebutton-wrapper").append(e),i.element.append(f)),i.element.append(c("<div>").addClass("smb-minicomponent-handle fa fa-ellipsis-v")),d.append(i.element)})};return e(),h(a.addEventName,function(d){var h,j=a.xmlParentFunction&&a.xmlParentFunction();d=d&&!d.element?c(d):f.getBuilder(a.builderName).defaultStateGenerator(),j.length||(h=a.xmlGrandParentFunction&&a.xmlGrandParentFunction(),j=f.defaultStateGenerators[a.parentBuilderName](),h.append(j)),j.append(d),b.componentViewer.loadComponent(d).select(),g.processResponsiveElements(),i("skuidBuilderSave"),e()}),h(a.refreshEventName,function(){e()}),d}),j("mobileBuilderPropertyPanelHeader",function(a){var b,d,e=a.element||c("<div>"),f=c("<div>").addClass("sm-titlebutton-wrapper").css("padding","4px").appendTo(e);return e.addClass("smb-propview-header sm-title").css("padding","10px 10px 9px 10px"),c("<div>").addClass("smb-propviewer-headertext").text(a.title).appendTo(e),a.showCloseButton&&(b=c("<div>").addClass("sm-titlebutton fa fa-angle-double-left fa-fw").appendTo(f),a.closePanel&&b.click(function(){g.toggleLeftPanel(a.closePanel,{transition:"slide"})})),a.showAddButton&&(d=c("<div>").addClass("sm-titlebutton fa fa-plus-circle fa-fw").appendTo(f),a.eventToPublishOnAdd&&d.click(function(){i(a.eventToPublishOnAdd)})),e}),j("mobileBuilderPagePropertiesHeader",function(a){k("mobileBuilderPropertyPanelHeader")({element:a,title:"Edit Page Properties",showCloseButton:!0,closePanel:"pageproperties"})}),j("mobileBuilderResourcePanelHeader",function(a){k("mobileBuilderPropertyPanelHeader")({element:a,title:"Resources",showCloseButton:!0,closePanel:"resources"})}),j("mobileBuilderLabelList",function(a){k("mobileBuilderPropertyPanelList")({element:a,icon:"fa-angle-double-right",xmlParentFunction:function(){return b.resourcesXML.children("labels")},xmlGrandParentFunction:function(){return b.resourcesXML},addEventName:"skuidMobileAddLabelItem",builderName:"label",parentBuilderName:"labels",refreshEventName:"skuidBuilderRefreshLabelList",labelFunction:function(a){return a.attr("id")||"[No Label ID]"},showRemoveButton:!0,indentLevel:2})}),j("mobileBuilderJSList",function(a){k("mobileBuilderPropertyPanelList")({element:a,icon:"fa-angle-double-right",xmlParentFunction:function(){return b.resourcesXML.children("javascript")},xmlGrandParentFunction:function(){return b.resourcesXML},addEventName:"skuidMobileAddJSItem",builderName:"jsitem",parentBuilderName:"javascript",refreshEventName:"skuidBuilderRefreshJSItemList",labelFunction:function(a){return f.getJSItemLabel(a).name||"[No Javascript Item Name]"},showRemoveButton:!0,indentLevel:2})}),j("mobileBuilderCSSList",function(a){k("mobileBuilderPropertyPanelList")({element:a,icon:"fa-angle-double-right",xmlParentFunction:function(){return b.resourcesXML.children("css")},xmlGrandParentFunction:function(){return b.resourcesXML},addEventName:"skuidMobileAddCSSItem",builderName:"cssitem",parentBuilderName:"css",refreshEventName:"skuidBuilderRefreshCSSItemList",labelFunction:function(a){return f.getCSSItemLabel(a)},showRemoveButton:!0,indentLevel:2})}),j("mobileBuilderXMLEditLink",function(b){var c=new a.ui.Editor(b),d=new g.ui.Button({icon:"fa-code",label:"Edit Page XML"});d.element.addClass("sm-button").click(function(){window.location="/apex/skuid__ui?page=PageXMLEdit&id="+a.$M("page").data[0].Id}),c.registerModel(a.model.getModel("page")),c.handleSave=function(a){a&&b.show()},c.handleCancel=function(){b.show()},c.handleChange=function(){b.hide()},b.append(d.element)}),h("skuidBuilderComponentSelect",function(a){"model"===a.builderId&&f.setLastSelectedModelComponent(a)}),a.snippet.register("saveAndPreview",function(){var b=arguments[0],c=b.model||a.model.getModel("page"),d=b.component.editor,e=a.snippet.getSnippet("skuid.builder.page.preview");e&&e({editor:d,model:c,saveFirst:!0})})}(skuid);